<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.26">
<title>Spring Data Aerospike - Documentation</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child{border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock pre>code{display:block}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active,#footnotes .footnote a:first-of-type:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="book">
<div id="header">
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<!-- toc disabled -->
<style>
/* Style the page title with the same red as section headers */
#header h1,
h1#spring-data-aerospike-documentation {
  color: #ba3925;
}

/* Make room for the sidebar by adding margin to the main content */
#content {
  margin-right: 260px;
}
#header, #footer {
  margin-right: 260px;
}

.quick-nav {
  position: fixed;
  top: 20px;
  right: 20px;
  width: 220px;
  max-height: calc(100vh - 40px);
  overflow-y: auto;
  background: #f8f8f8;
  border: 1px solid #ddd;
  border-radius: 6px;
  padding: 12px 16px;
  font-family: "Open Sans", "DejaVu Sans", sans-serif;
  font-size: 0.85em;
  font-weight: 300;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  z-index: 100;
}
.quick-nav h3 {
  margin: 0 0 10px 0;
  padding-bottom: 8px;
  border-bottom: 2px solid #ba3925;
  color: #ba3925;
  font-size: 1.1em;
}
.quick-nav ul {
  list-style: none;
  margin: 0;
  padding: 0;
}
.quick-nav li {
  margin: 4px 0;
  line-height: 1.4;
}
.quick-nav a {
  color: #2156a5;
  text-decoration: none;
}
.quick-nav a:hover {
  color: #ba3925;
  text-decoration: underline;
}

/* On smaller screens, remove sidebar and restore full width */
@media (max-width: 1200px) {
  .quick-nav { display: none; }
  #content, #header, #footer { margin-right: 0; }
}
</style>

<div class="quick-nav">
  <h3>Table of contents</h3>
  <ul>
    <li><a href="#preface">Preface</a></li>
    <li><a href="#aerospike.functionality">Functionality</a></li>
    <li><a href="#aerospike.installation_and_usage">Installation & Usage</a></li>
    <li><a href="#configuration">Configuration</a></li>
    <li><a href="#tls">TLS Configuration</a></li>
    <li><a href="#aerospike.repositories">Aerospike Repositories</a></li>
    <li><a href="#aerospike.reactive.repositories">Reactive Repositories</a></li>
    <li><a href="#aerospike.projections">Projections</a></li>
    <li><a href="#aerospike.query-methods-preface">Query Methods</a></li>
    <li><a href="#aerospike.query_methods.simple_property">Simple Property Queries</a></li>
    <li><a href="#aerospike.query_methods.collection">Collection Queries</a></li>
    <li><a href="#aerospike.query_methods.map">Map Queries</a></li>
    <li><a href="#aerospike.query_methods.pojo">POJO Queries</a></li>
    <li><a href="#aerospike.query_methods.id">Id Queries</a></li>
    <li><a href="#aerospike.query-methods-combined">Combined Query Methods</a></li>
    <li><a href="#query-methods-modification">Query Modification</a></li>
    <li><a href="#custom-queries">Custom Queries</a></li>
    <li><a href="#dsl.expressions">DSL Expressions</a></li>
    <li><a href="#aerospike.object-mapping">Object Mapping</a></li>
    <li><a href="#aerospike.custom-converters">Custom Converters</a></li>
    <li><a href="#pagination_and_sorting">Pagination & Sorting</a></li>
    <li><a href="#aerospike.template">Aerospike Template</a></li>
    <li><a href="#secondary-indexes">Secondary Indexes</a></li>
    <li><a href="#indexed-annotation">Indexed Annotation</a></li>
    <li><a href="#aerospike.scan-operation">Scan Operation</a></li>
    <li><a href="#caching">Caching</a></li>
    <li><a href="#transactions">Transactions</a></li>
  </ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_spring_data_aerospike_documentation">Spring Data Aerospike - Documentation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>&#169; 2018-2026 The original authors.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Copies of this document may be made for your own use and for distribution to others, provided that you do not
charge any fee for such copies and further provided that each copy contains this Copyright Notice, whether distributed
in print or electronically.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="preface">Preface</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Spring Data Aerospike project applies core Spring concepts and provides interface for using Aerospike key-value
style data store.  We provide a "repository" and a "template" as high-level abstractions for storing and querying data.
You will notice similarities to the JDBC support in the Spring Framework.</p>
</div>
<div class="paragraph">
<p>This chapter provides some basic introduction to Spring and Aerospike, it explains Aerospike concepts and syntax.
The rest of the documentation refers to Spring Data Aerospike features and assumes the user is familiar
with Aerospike as well as Spring concepts.</p>
</div>
<div class="sect2">
<h3 id="get-started:first-steps:spring">Knowing Spring</h3>
<div class="paragraph">
<p>Spring Data uses Spring framework&#8217;s
<a href="https://docs.spring.io/spring/docs/3.2.x/spring-framework-reference/html/spring-core.html">core</a> functionality, such as
the <a href="https://docs.spring.io/spring/docs/3.2.x/spring-framework-reference/html/beans.html">IoC</a> container,
<a href="https://docs.spring.io/spring/docs/3.2.x/spring-framework-reference/html/validation.html#core-convert">type conversion system</a>,
<a href="https://docs.spring.io/spring/docs/3.2.x/spring-framework-reference/html/dao.html#dao-exceptions">DAO exception hierarchy</a>
etc. While it is not important to know the Spring APIs, understanding the concepts behind them is.
At a minimum, the idea behind IoC should be familiar regardless of IoC container you choose to use.</p>
</div>
<div class="paragraph">
<p>To learn more about Spring, you can refer to the comprehensive documentation that explains in detail the Spring Framework.
There are a lot of articles, blog entries and books on the matter - take a look at the Spring framework
<a href="https://docs.spring.io/spring-framework/reference/">documentation reference</a> for more information.</p>
</div>
</div>
<div class="sect2">
<h3 id="get-started:first-steps:nosql">Knowing NoSQL and Aerospike</h3>
<div class="paragraph">
<p>NoSQL stores have taken the storage world by storm. It is a vast domain with a plethora of solutions, terms and patterns
(to make things worthwhile even the term itself has multiple <a href="https://www.google.com/search?q=nosoql+acronym">meanings</a>).
While some principles are common, it is crucial that the user is familiar to some degree with Aerospike key-value
store operations that supply the mechanism for associating keys with a set of named values, similar to a row in
standard RDBMS terminology.  The data layer in Aerospike Database is optimized to store data in solid state drives,
RAM, or traditional rotational media. The database indices are stored in RAM for quick availability, and data writes
are optimized through large block writes to reduce latency. The software also employs two sub-programs that are
codenamed Defragmenter and Evictor. Defragmenter removes data blocks that have been deleted, and Evictor frees RAM space
by removing references to expired records.</p>
</div>
<div class="paragraph">
<p>The jumping off ground for learning about Aerospike is <a href="https://www.aerospike.com/">www.aerospike.com</a>. Here is a list of
other useful resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <a href="https://www.aerospike.com/docs/">technical documentation</a> introduces Aerospike and contains links to getting
started guides, reference documentation and tutorials.</p>
</li>
<li>
<p>The <a href="https://www.aerospike.com/docs/client/java/">java client documentation</a> provides a convenient way to interact
with an Aerospike instance in combination with the online
<a href="https://www.aerospike.com:443/docs/client/java/start/index.html/">Getting started</a></p>
</li>
<li>
<p><a href="https://www.aerospike.com/community/">Aerospike Community</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="requirements">Requirements</h3>
<div class="paragraph">
<p>Spring Data Aerospike binaries require JDK level 17.0 and above.</p>
</div>
<div class="paragraph">
<p>In terms of server, it is required to use  at least <a href="https://www.aerospike.com/download/server/">Aerospike server</a>
version 6.1 (recommended to use the latest version when possible).</p>
</div>
</div>
<div class="sect2">
<h3 id="_additional_help_resources">Additional Help Resources</h3>
<div class="paragraph">
<p>Learning a new framework is not always straightforward. In this section, we try to provide what we think is an
easy-to-follow guide for starting with Spring Data Aerospike module. However, if you encounter issues, or you are
just looking for advice, feel free to use one of the links below:</p>
</div>
</div>
<div class="sect2">
<h3 id="get-started:help">Support</h3>
<div class="paragraph">
<p>There are a few support options available:</p>
</div>
<div class="sect3">
<h4 id="get-started:help:community">Questions &amp; Answers</h4>
<div class="paragraph">
<p>Developers post questions and answers on Stack Overflow. The two key tags to search for related answers to this project
are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://stackoverflow.com/questions/tagged/spring-data">spring-data</a></p>
</li>
<li>
<p><a href="https://stackoverflow.com/questions/tagged/spring-data-aerospike">spring-data-aerospike</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="get-started:up-to-date">Following Development</h4>
<div class="paragraph">
<p>If you encounter a bug or want to suggest an improvement, please create an
<a href="https://github.com/aerospike/spring-data-aerospike/issues">issue on GitHub</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="reference-documentation">Reference documentation</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="aerospike.functionality">Functionality</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://github.com/aerospike/spring-data-aerospike">Spring Data Aerospike project</a> aims to provide a familiar
and consistent Spring-based programming model providing integration with the Aerospike database.</p>
</div>
<div class="paragraph">
<p>Spring Data Aerospike supports a wide range of features summarized below:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Supporting Repository interfaces (out-of-the-box CRUD operations and query implementations, for more information
see <a href="#aerospike.repositories">Aerospike Repositories</a>)</p>
</li>
<li>
<p>AerospikeTemplate for lower-level access to common Aerospike operations and fine-tuning (for more information
see <a href="#aerospike.template">AerospikeTemplate</a>)</p>
</li>
<li>
<p><a href="#aerospike.object-mapping">Feature Rich Object Mapping</a> integrated with Spring&#8217;s Conversion Service</p>
</li>
<li>
<p>Translating exceptions into Spring&#8217;s
<a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/html/dao.html#dao-exceptions">Data Access Exception hierarchy</a></p>
</li>
<li>
<p>Annotation-based metadata mapping</p>
</li>
<li>
<p>Ability to directly utilize Aerospike Java client functionality</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="aerospike.installation_and_usage">Installation &amp; Usage</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_getting_started">Getting Started</h3>
<div class="paragraph">
<p>First, you need a running <a href="https://docs.aerospike.com/server/operations/install/verify">Aerospike server</a> to connect to.</p>
</div>
<div class="paragraph">
<p>To use Spring Data Aerospike you can either set up Spring Boot or Spring application. Basic setup of Spring Boot
application is described here: <a href="https://projects.spring.io/spring-boot" class="bare">https://projects.spring.io/spring-boot</a>.</p>
</div>
<div class="paragraph">
<p>In case you do not want to use Spring Boot, the best way to manage Spring dependencies is to declare
<code>spring-framework-bom</code> of the needed version in the <code>dependencyManagement</code> section of your <code>pom.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependencyManagement&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework&lt;/groupId&gt;
            &lt;artifactId&gt;spring-framework-bom&lt;/artifactId&gt;
            &lt;version&gt;${spring-data-aerospike.version}&lt;/version&gt;
            &lt;type&gt;pom&lt;/type&gt;
            &lt;scope&gt;import&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/dependencyManagement&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
To create a Spring project in STS (Spring Tool Suite) go to File &#8594; New &#8594; Spring Template Project &#8594;
Simple Spring Utility Project &#8594; press "Yes" when prompted.
Then enter a project and a package name such as <code>org.spring.aerospike.example</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_adding_dependency">Adding Dependency</h3>
<div class="paragraph">
<p>The first step is to add Spring Data Aerospike to your build process. It is recommended to use the latest version
which can be found on the <a href="https://github.com/aerospike/spring-data-aerospike/releases">GitHub Releases</a> page.</p>
</div>
<div class="paragraph">
<p>Adding Spring Data Aerospike dependency in Maven:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.aerospike&lt;/groupId&gt;
    &lt;artifactId&gt;spring-data-aerospike&lt;/artifactId&gt;
    &lt;version&gt;${spring-data-aerospike.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Adding Spring Data Aerospike dependency in Gradle:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">implementation group: 'com.aerospike', name: 'spring-data-aerospike', version: '${spring-data-aerospike.version}'</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_connecting_to_aerospike_db">Connecting to Aerospike DB</h3>
<div class="paragraph">
<p>There are two ways of configuring a basic connection to Aerospike DB:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Overriding <code>getHosts()</code> and <code>nameSpace()</code> methods via the <code>AbstractAerospikeDataConfiguration</code> class:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Configuration
@EnableAerospikeRepositories(basePackageClasses = { PersonRepository.class})
public class AerospikeConfiguration extends AbstractAerospikeDataConfiguration {

    @Override
    protected Collection&lt;Host&gt; getHosts() {
        return Collections.singleton(new Host("localhost", 3000));
    }

    @Override
    protected String nameSpace() {
        return "test";
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When setting the configuration this way, you can also optionally override <code>configureDataSettings()</code> method
which allows to set non-mandatory properties.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Configuration
@EnableAerospikeRepositories(basePackageClasses = { PersonRepository.class})
public class AerospikeConfiguration extends AbstractAerospikeDataConfiguration {

    @Override
    protected Collection&lt;Host&gt; getHosts() {
        return Collections.singleton(new Host("localhost", 3000));
    }

    @Override
    protected String nameSpace() {
        return "test";
    }

    @Override
    protected void configureDataSettings(AerospikeDataSettings aerospikeDataSettings) {
        aerospikeDataSettings.setScansEnabled(true);
    }
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Using <code>application.properties</code>:</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Basic configuration in this case requires enabling repositories and then setting <code>hosts</code> and <code>namespace</code> in the
<code>application.properties</code> file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Configuration
@EnableAerospikeRepositories(basePackageClasses = { PersonRepository.class})
public class AerospikeConfiguration extends AbstractAerospikeDataConfiguration {

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In <code>application.properties</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties"># application.properties
spring.aerospike.hosts=localhost:3000
spring.data.aerospike.namespace=test</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Return values of <code>getHosts()</code>, <code>nameSpace()</code> and <code>configureDataSettings()</code> methods have precedence
over <code>hosts</code> and <code>namespace</code> parameters set via application.properties.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For more detailed information see <a href="#configuration">Configuration</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_creating_functionality">Creating Functionality</h3>
<div class="paragraph">
<p>The base functionality is provided by <code>AerospikeRepository</code> interface.</p>
</div>
<div class="paragraph">
<p>It typically takes 2 parameters:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The type managed by a class (it is typically entity class) to be stored in the database.</p>
</li>
<li>
<p>The type of ID.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Application code typically extends this interface for each of the types to be managed, and methods can be added
to the interface to determine how the application can access the data. For example, consider a class <code>Person</code>
with a simple structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@AllArgsConstructor
@NoArgsConstructor
@Data
@Document
public class Person {
    @Id
    private long id;
    private String firstName;
    private String lastName;
    @Field("dob")
    private Date dateOfBirth;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that this example uses the <a href="https://projectlombok.org/">Project Lombok</a> annotations to remove the need for
explicit constructors and getters and setters. Normal POJOs which define these on their own can ignore
the <code>@AllArgsConstructor</code>, <code>@NoArgsConstructor</code> and <code>@Data</code> annotations. The <code>@Document</code> annotation tells
Spring Data Aerospike that this is a domain object to be persisted in the database, and <code>@Id</code> identifies
the primary key of this class. The <code>@Field</code> annotation is used to create a shorter name for the bin in the
Aerospike database (<code>dateOfBirth</code> will be stored in a bin called <code>dob</code> in this example).</p>
</div>
<div class="paragraph">
<p>For the <code>Person</code> object to be persisted to Aerospike, you must create an interface with the desired methods for
retrieving data. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public interface PersonRepository extends AerospikeRepository&lt;Person, Long&gt; {
    List&lt;Person&gt; findByLastName(String lastName);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This defines a repository that can write <code>Person</code> entities and also query them by last name. The <code>AerospikeRepository</code>
extends both <code>PagingAndSortingRepository</code> and <code>CrudRepository</code>, so methods like <code>count()</code>, <code>findById()</code>, <code>save()</code>
and <code>delete()</code> are there by default. Those who need reactive flow can use <code>ReactiveAerospikeRepository</code> instead.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Repository is just an interface and not an actual class. In the background, when your context gets initialized,
actual implementations for your repository descriptions get created, and you can access them through regular beans.
This means you will omit lots of boilerplate code while still exposing full CRUD semantics to your service layer
and application.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Example repository is ready for use. A sample Spring Controller which uses this repository could be the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@RestController
public class ApplicationController {
    @Autowired
    private PersonRepository personRepsitory;

    @GetMapping("/seed")
    public int seedData() {
        Person person = new Person(1, "Bob", "Jones", new GregorianCalendar(1971, 12, 19).getTime());
        personRepsitory.save(person);
        return 1;
    }

    @GetMapping("/findByLastName/{lastName}")
    public List&lt;Person&gt; findByLastName(@PathVariable(name = "lastName", required=true) String lastName) {
        return personRepsitory.findByLastName(lastName);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Invoking the <code>seed</code> method above gives you a record in the Aerospike database which looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">aql&gt; select * from test.Person where pk = "1"
+-----+-----------+----------+-------------+-------------------------------------+
| PK  | firstName | lastName | dob         | @_class                             |
+-----+-----------+----------+-------------+-------------------------------------+
| "1" | "Bob"     | "Jones"  | 64652400000 | "com.aerospike.sample.model.Person" |
+-----+-----------+----------+-------------+-------------------------------------+
1 row in set (0.001 secs)</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The fully qualified path of the class is listed in each record. This is needed to instantiate the class
correctly, especially in cases when the compile-time type and runtime type of the object differ. For example,
where a field is declared as a super class but the instantiated class is a subclass.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
By default, the type of the field annotated with <code>@id</code> is turned into a <code>String</code> to be stored in
Aerospike database. If the original type cannot be persisted
(see <a href="#configuration.keep-original-key-types">keepOriginalKeyTypes</a> for details), it must be convertible
to <code>String</code> and will be stored in the database as such, then converted back to the original type when the object
is read. This is transparent to the application but needs to be considered if using external tools like <code>AQL</code>
to view the data.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration">Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Configuration can be applied using one of these ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Via parameters with <code>spring.aerospike*</code>
and <code>spring.data.aerospike*</code> prefixes in <code>application.properties</code> file, and using configuration class to enable repositories.</p>
</li>
<li>
<p>By overriding methods <code>getHosts()</code>, <code>nameSpace()</code>, <code>configureDataSettings()</code> and enabling repositories
in a configuration class. These methods have precedence over parameters set in application.properties.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="configuration.application-properties">Application.properties and Enabling Repositories</h3>
<div class="paragraph">
<p>Here is an example of this approach:</p>
</div>
<div class="listingblock">
<div class="title">application.properties</div>
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties"># Aerospike
spring.aerospike.hosts=localhost:3000
### Auth (if required)
# spring.aerospike.user=user
# spring.aerospike.password=password
spring.data.aerospike.namespace=test
spring.data.aerospike.scans-enabled=false
spring.data.aerospike.send-key=true
spring.data.aerospike.create-indexes-on-startup=true
spring.data.aerospike.index-cache-refresh-seconds=3600
spring.data.aerospike.server-version-refresh-seconds=3600
spring.data.aerospike.query-max-records=10000
spring.data.aerospike.batch-write-size=100
spring.data.aerospike.keep-original-key-types=false</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Configuration class</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Configuration
@EnableAerospikeRepositories(basePackageClasses = {TestRepository.class})
public class AerospikeConfiguration extends AbstractAerospikeDataConfiguration {

}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Depending on the use case it might be required to override optional configuration methods like
<a href="#aerospike.custom-converters"><code>customConverters()</code></a> or <a href="#configuration.client-policy"><code>getClientPolicy()</code></a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="configuration.overriding-configuration">Overriding Configuration Methods</h3>
<div class="paragraph">
<p>Configuration can also be set by overriding <code>getHosts()</code>, <code>nameSpace()</code> and <code>configureDataSettings()</code> methods.</p>
</div>
<div class="paragraph">
<p>Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@EnableAerospikeRepositories(basePackageClasses = TestRepository.class)
class ApplicationConfig extends AbstractAerospikeDataConfiguration {

    @Override
    protected Collection&lt;Host&gt; getHosts() {
        return Collections.singleton(new Host("localhost", 3000));
    }

    @Override
    protected String nameSpace() {
        return "test";
    }

    @Override
    protected void configureDataSettings(AerospikeDataSettings aerospikeDataSettings) {
        aerospikeDataSettings.setScansEnabled(false);
        aerospikeDataSettings.setCreateIndexesOnStartup(true);
        aerospikeDataSettings.setIndexCacheRefreshSeconds(3600);
        aerospikeDataSettings.setServerVersionRefreshSeconds(3600);
        aerospikeDataSettings.setQueryMaxRecords(10000L);
        aerospikeDataSettings.setBatchWriteSize(100);
        aerospikeDataSettings.setKeepOriginalKeyTypes(false);
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Return values of <code>getHosts()</code>, <code>nameSpace()</code> and <code>configureDataSettings()</code> methods have precedence over the
parameters set via application.properties.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Depending on the use case it might be required to override other configuration methods like
<a href="#aerospike.custom-converters"><code>customConverters()</code></a> or <a href="#configuration.client-policy"><code>getClientPolicy()</code></a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="configuration.parameters">Configuration Parameters</h3>
<div class="sect3">
<h4 id="configuration.hosts">hosts</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties"># application.properties
spring.aerospike.hosts=hostname1:3001, hostname2:tlsName2:3002</code></pre>
</div>
</div>
<div class="paragraph">
<p>A String of hosts separated by <code>,</code> in form of <code>hostname1[:tlsName1][:port1],&#8230;&#8203;</code></p>
</div>
<div class="paragraph">
<p>IP addresses must be given in one of the following formats:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">IPv4: xxx.xxx.xxx.xxx
IPv6: [xxxx:xxxx:xxxx:xxxx:xxxx:xxxx:xxxx:xxxx]
IPv6: [xxxx::xxxx]</code></pre>
</div>
</div>
<div class="paragraph">
<p>IPv6 addresses must be enclosed by brackets. tlsName is optional.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Another way of defining hosts is overriding the <code>getHosts()</code> method.
It has precedence over <code>spring.aerospike.hosts</code> parameter from application.properties. Here is an example:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// overriding method
@EnableAerospikeRepositories(basePackageClasses = TestRepository.class)
class ApplicationConfig extends AbstractAerospikeDataConfiguration {

    @Override
    protected Collection&lt;Host&gt; getHosts() {
        return Collections.singleton(new Host("hostname1", 3001));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Default:</strong> <code>localhost:3000</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuration.user">user</h4>
<div class="listingblock">
<div class="content">
<pre># application.properties
spring.aerospike.user=user</pre>
</div>
</div>
<div class="paragraph">
<p>Specifies the username used to authenticate against the Aerospike database cluster.
This property is optional and only needed when the Aerospike cluster requires authentication.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Another way of defining username is overriding the <code>getClientPolicy()</code> method.
It has precedence over <code>spring.aerospike.user</code> parameter from application.properties.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See <a href="#configuration.client-policy">ClientPolicy</a> for more details.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuration.password">password</h4>
<div class="listingblock">
<div class="content">
<pre># application.properties
spring.aerospike.password=password</pre>
</div>
</div>
<div class="paragraph">
<p>Defines the password associated with the configured Aerospike user.
Like the username, this property is optional and only needed when the Aerospike cluster requires authentication.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Another way of defining password is overriding the <code>getClientPolicy()</code> method.
It has precedence over <code>spring.aerospike.password</code> parameter from application.properties.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See <a href="#configuration.client-policy">ClientPolicy</a> for more details.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuration.namespace">namespace</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties"># application.properties
spring.data.aerospike.namespace=test</code></pre>
</div>
</div>
<div class="paragraph">
<p>Aerospike DB namespace.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Another way of defining namespace is overriding the <code>nameSpace()</code> method.
It has precedence over <code>spring.data.aerospike.namespace</code> parameter from application.properties.
Here is an example:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// overriding method
@EnableAerospikeRepositories(basePackageClasses = TestRepository.class)
class ApplicationConfig extends AbstractAerospikeDataConfiguration {

    @Override
    protected String nameSpace() {
        return "test";
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
To use multiple namespaces it is required to override <code>nameSpace()</code> and <code>AerospikeTemplate</code> for each
configuration class per namespace.
See <a href="https://github.com/aerospike-examples/spring-data-multiple-namespaces-example">multiple namespaces example</a>
for implementation details.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Default:</strong> <code>test</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuration.scans-enabled">scansEnabled</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties"># application.properties
spring.data.aerospike.scans-enabled=false</code></pre>
</div>
</div>
<div class="paragraph">
<p>Whether to enable <a href="#aerospike.scan-operation">scan operations</a>.</p>
</div>
<div class="paragraph">
<p>Due to the cost of performing this operation, scans from Spring Data Aerospike are disabled by default.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Another way of defining the parameter is overriding the <code>configureDataSettings()</code> method.
It has precedence over reading from application.properties. Here is an example:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// overriding method
@EnableAerospikeRepositories(basePackageClasses = TestRepository.class)
class ApplicationConfig extends AbstractAerospikeDataConfiguration {

    @Override
    protected void configureDataSettings(AerospikeDataSettings aerospikeDataSettings) {
        aerospikeDataSettings.setScansEnabled(false);
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Once this flag is enabled, scans run whenever needed with no warnings. This may or may not be optimal
in a particular use case.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Default:</strong> <code>false</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuration.create-indexes-on-startup">createIndexesOnStartup</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties"># application.properties
spring.data.aerospike.create-indexes-on-startup=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create secondary indexes specified using <code>@Indexed</code> annotation on startup.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Another way of defining the parameter is overriding the <code>configureDataSettings()</code> method.
It has precedence over reading from application.properties. Here is an example:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// overriding method
@EnableAerospikeRepositories(basePackageClasses = TestRepository.class)
class ApplicationConfig extends AbstractAerospikeDataConfiguration {

    @Override
    protected void configureDataSettings(AerospikeDataSettings aerospikeDataSettings) {
        aerospikeDataSettings.setCreateIndexesOnStartup(true);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Default</strong>: <code>true</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuration.index-cache-refresh-frequency-seconds">indexCacheRefreshSeconds</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties"># application.properties
spring.data.aerospike.index-cache-refresh-seconds=3600</code></pre>
</div>
</div>
<div class="paragraph">
<p>Automatically refresh indexes cache every &lt;N&gt; seconds.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Another way of defining the parameter is overriding the <code>configureDataSettings()</code> method.
It has precedence over reading from application.properties. Here is an example:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// overriding method
@EnableAerospikeRepositories(basePackageClasses = TestRepository.class)
class ApplicationConfig extends AbstractAerospikeDataConfiguration {

    @Override
    protected void configureDataSettings(AerospikeDataSettings aerospikeDataSettings) {
        aerospikeDataSettings.setIndexCacheRefreshSeconds(3600);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Default</strong>: <code>3600</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuration.server-version-refresh-frequency-seconds">serverVersionRefreshSeconds</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties"># application.properties
spring.data.aerospike.server-version-refresh-seconds=3600</code></pre>
</div>
</div>
<div class="paragraph">
<p>Automatically refresh cached server version every &lt;N&gt; seconds.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Another way of defining the parameter is overriding the <code>configureDataSettings()</code> method.
It has precedence over reading from application.properties. Here is an example:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// overriding method
@EnableAerospikeRepositories(basePackageClasses = TestRepository.class)
class ApplicationConfig extends AbstractAerospikeDataConfiguration {

    @Override
    protected void configureDataSettings(AerospikeDataSettings aerospikeDataSettings) {
        aerospikeDataSettings.setServerVersionRefreshSeconds(3600);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Default</strong>: <code>3600</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuration.query-max-records">queryMaxRecords</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties"># application.properties
spring.data.aerospike.query-max-records=10000</code></pre>
</div>
</div>
<div class="paragraph">
<p>Limit amount of results returned by server. Non-positive value means no limit.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Another way of defining the parameter is overriding the <code>configureDataSettings()</code> method.
It has precedence over reading from application.properties. Here is an example:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// overriding method
@EnableAerospikeRepositories(basePackageClasses = TestRepository.class)
class ApplicationConfig extends AbstractAerospikeDataConfiguration {

    @Override
    protected void configureDataSettings(AerospikeDataSettings aerospikeDataSettings) {
        aerospikeDataSettings.setQueryMaxRecords(10000L);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Default</strong>: <code>10 000</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuration.batch-read-size">batchReadSize</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties"># application.properties
spring.data.aerospike.batch-read-size=100</code></pre>
</div>
</div>
<div class="paragraph">
<p>Maximal batch size for batch read operations. Query data larger than the specified batch-read-size will be firstly
chunked into segments. Non-positive value of the batch-read-size parameter means no limit.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Another way of defining the parameter is overriding the <code>configureDataSettings()</code> method.
It has precedence over reading from application.properties. Here is an example:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// overriding method
@EnableAerospikeRepositories(basePackageClasses = TestRepository.class)
class ApplicationConfig extends AbstractAerospikeDataConfiguration {

    @Override
    protected void configureDataSettings(AerospikeDataSettings aerospikeDataSettings) {
        aerospikeDataSettings.setBatchReadSize(1000);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Default</strong>: <code>100</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuration.batch-write-size">batchWriteSize</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties"># application.properties
spring.data.aerospike.batch-write-size=100</code></pre>
</div>
</div>
<div class="paragraph">
<p>Maximal batch size for batch write operations. Query data larger than the specified batch-write-size will be firstly
chunked into segments. Non-positive value of the batch-write-size parameter means no limit.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Another way of defining the parameter is overriding the <code>configureDataSettings()</code> method.
It has precedence over reading from application.properties. Here is an example:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// overriding method
@EnableAerospikeRepositories(basePackageClasses = TestRepository.class)
class ApplicationConfig extends AbstractAerospikeDataConfiguration {

    @Override
    protected void configureDataSettings(AerospikeDataSettings aerospikeDataSettings) {
        aerospikeDataSettings.setBatchWriteSize(1000);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Default</strong>: <code>100</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuration.keep-original-key-types">keepOriginalKeyTypes</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties"># application.properties
spring.data.aerospike.keep-original-key-types=false</code></pre>
</div>
</div>
<div class="paragraph">
<p>Define how <code>@Id</code> fields (primary keys) and <code>Map</code> keys are stored in the Aerospike database:
<code>false</code> - always as <code>String</code>, <code>true</code> - preserve original type if supported.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 37.5%;">
<col style="width: 37.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><code>@Id</code> field type</th>
<th class="tableblock halign-left valign-top">keepOriginalKeyTypes = <code>false</code></th>
<th class="tableblock halign-left valign-top">keepOriginalKeyTypes = <code>true</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>long</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>long</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>long</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>byte[]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>byte[]</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">other types</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If <code>@Id</code> field&#8217;s type cannot be persisted as is, it must be convertible to <code>String</code> and will be stored
in the database as such, then converted back to the original type when the object is read.
This is transparent to the application but needs to be considered if using external tools like <code>AQL</code> to view the data.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 37.5%;">
<col style="width: 37.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><code>Map</code> key type</th>
<th class="tableblock halign-left valign-top">keepOriginalKeyTypes = <code>false</code></th>
<th class="tableblock halign-left valign-top">keepOriginalKeyTypes = <code>true</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>long</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>long</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>long</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>double</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>double</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>byte[]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>byte[]</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">other types</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Another way of defining the parameter is overriding the <code>configureDataSettings()</code> method.
It has precedence over reading from application.properties. Here is an example:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// overriding method
@EnableAerospikeRepositories(basePackageClasses = TestRepository.class)
class ApplicationConfig extends AbstractAerospikeDataConfiguration {

    @Override
    protected void configureDataSettings(AerospikeDataSettings aerospikeDataSettings) {
        aerospikeDataSettings.setKeepOriginalKeyTypes(false);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Default</strong>: <code>false</code> (store keys only as <code>String</code>).</p>
</div>
</div>
<div class="sect3">
<h4 id="configuration.write-sorted-maps">writeSortedMaps</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties"># application.properties
spring.data.aerospike.writeSortedMaps=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>Define how Maps and POJOs are written: <code>true</code> - as sorted maps (<code>TreeMap</code>, default), <code>false</code> - as unsorted (<code>HashMap</code>).</p>
</div>
<div class="paragraph">
<p>Writing as unsorted maps (<code>false</code>) degrades performance of Map-related operations and does not allow comparing Maps,
so it is strongly recommended to change the default value only if required during upgrade from older versions
of Spring Data Aerospike.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Another way of defining the parameter is overriding the <code>configureDataSettings()</code> method.
It has precedence over reading from application.properties. Here is an example:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// overriding method
@EnableAerospikeRepositories(basePackageClasses = TestRepository.class)
class ApplicationConfig extends AbstractAerospikeDataConfiguration {

    @Override
    protected void configureDataSettings(AerospikeDataSettings aerospikeDataSettings) {
        aerospikeDataSettings.setWriteSortedMaps(true);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Default</strong>: <code>true</code> (write Maps and POJOs as sorted maps).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuration.client-policy">ClientPolicy</h3>
<div class="paragraph">
<p>To set the necessary <code>ClientPolicy</code> parameters of the underlying Java client, override the <code>getClientPolicy()</code> method and call <code>super.getClientPolicy()</code> to apply default values first.</p>
</div>
<div class="paragraph">
<p>Here is an example with several parameters set for running a test:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class MyConfiguration extends AbstractAerospikeDataConfiguration {

    @Override
    protected ClientPolicy getClientPolicy() {
        ClientPolicy clientPolicy = super.getClientPolicy(); // applying default values first
        int totalTimeout = 2000;
        clientPolicy.readPolicyDefault.totalTimeout = totalTimeout;
        clientPolicy.writePolicyDefault.totalTimeout = totalTimeout;
        clientPolicy.batchPolicyDefault.totalTimeout = totalTimeout;
        clientPolicy.infoPolicyDefault.timeout = totalTimeout;
        clientPolicy.readPolicyDefault.maxRetries = 3;
        // optionally set user authentication properties
        // clientPolicy.setUser("user");
        // clientPolicy.setPassword("password");
        return clientPolicy;
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tls">TLS Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If a TLS connection is required, initialize new <code>TlsPolicy</code> for the underlying Java client.</p>
</div>
<div class="paragraph">
<p>Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class MyConfiguration extends AbstractAerospikeDataConfiguration {

    @Override
    protected ClientPolicy getClientPolicy() {
        ClientPolicy clientPolicy = super.getClientPolicy(); // applying default values first
        clientPolicy.tlsPolicy = new TlsPolicy();
        return clientPolicy;
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
For running with TLS, an application must have the appropriate certificate. When using default <code>TlsPolicy</code> with the regular TLS it is typically required to provide the certificate via JVM argument <code>-Djavax.net.ssl.trustStore</code>. For details on configuring TLS see <a href="https://aerospike.com/docs/server/operations/configure/network/tls">TLS Configuration</a>, <a href="https://github.com/aerospike-examples/aerospike-tls-examples/blob/master/tls-example-java/README.md">Aerospike TLS Example</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="aerospike.repositories">Aerospike Repositories</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="aerospike.repositories.intro">Introduction</h3>
<div class="paragraph">
<p>One of the main goals of the Spring Data is to significantly reduce the amount of boilerplate code required to implement
data access layers for various persistence stores.</p>
</div>
<div class="paragraph">
<p>One of the core interfaces of Spring Data is <code>Repository</code>.
This interface acts primarily to capture the types to work with and to help user to discover interfaces that
extend Repository.</p>
</div>
<div class="paragraph">
<p>In other words, it allows user to have basic and complicated queries without writing the implementation.
This builds on the
<a href="https://docs.spring.io/spring-data/rest/reference/data-commons/repositories.html">Core Spring Data Repository Support</a>,
so make sure you&#8217;ve got a sound understanding of this concept.</p>
</div>
</div>
<div class="sect2">
<h3 id="aerospike.repositories.usage">Usage</h3>
<div class="paragraph">
<p>To access entities stored in Aerospike you can leverage repository support that eases implementing those quite
significantly. To do so, simply create an interface for your repository:</p>
</div>
<div class="exampleblock">
<div class="title">Example 1. Sample Person entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class Person {

	@Id
	private String id;
	private String name;
	private int age;
	public Person(String id, String name, int age) {
		this.id = id;
		this.name = name;
		this.age = age;
	}
  //  getters and setters omitted
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>We have a quite simple domain object here. The default serialization mechanism used in <code>AerospikeTemplate</code>
(which is backing the repository support) regards properties named "id" as document id.
Currently we support <code>String</code> and <code>long</code> as id-types.</p>
</div>
<div class="exampleblock">
<div class="title">Example 2. Basic repository interface to persist Person entities</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>public interface PersonRepository extends AerospikeRepository&lt;Person, String&gt; {

	List&lt;Person&gt; findByName(String name);

	List&lt;Person&gt; findByNameStartsWith(String prefix);

}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Right now this interface simply serves typing purposes, but we will add additional methods to it later.</p>
</div>
<div class="paragraph">
<p>We are going to use the <code>@EnableAerospikeRepositories</code> annotation. If no base package is configured the infrastructure
will scan the package of the annotated configuration class.</p>
</div>
<div class="exampleblock">
<div class="title">Example 3. JavaConfig for repositories</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Configuration
@EnableAerospikeRepositories(basePackages = "org.springframework.data.aerospike.example")
public class TestRepositoryConfig {
	public @Bean(destroyMethod = "close") AerospikeClient aerospikeClient() {

		ClientPolicy policy = new ClientPolicy();
		policy.failIfNotConnected = true;

		return new AerospikeClient(policy, "localhost", 3000);
	}

	public @Bean AerospikeTemplate aerospikeTemplate() {
		return new AerospikeTemplate(aerospikeClient(), "test");
	}
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As our domain repository extends <code>PagingAndSortingRepository</code> it provides you with CRUD operations as well as methods
for paginated and sorted access to the entities. Working with the repository instance is just a matter of dependency
injecting it into a client. So accessing the second page of `Person`s at a page size of 10 would simply look something
like this:</p>
</div>
<div class="exampleblock">
<div class="title">Example 4. Paging access to Person entities</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration
public class PersonRepositoryTests {

    @Autowired PersonRepository repository;

    @Test
    public void readsFirstPageCorrectly() {

      Page&lt;Person&gt; persons = repository.findAll(new PageRequest(0, 10));
      assertThat(persons.isFirstPage(), is(true));
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The sample creates an application context with Spring&#8217;s unit test support which will perform annotation-based
dependency injection into test cases. Inside the test method, we simply use the repository to query the datastore.
We hand the repository a <code>PageRequest</code> instance that requests the first page of persons at a page size of 10.</p>
</div>
</div>
<div class="sect2">
<h3 id="aerospike.repositories.queries">Query methods</h3>
<div class="paragraph">
<p>Most of the data access operations you usually trigger on a repository result in a query being executed against
the Aerospike databases. Defining such a query is just a matter of declaring a method on the repository interface</p>
</div>
<div class="exampleblock">
<div class="title">Example 5. PersonRepository with query methods</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public interface PersonRepository extends PagingAndSortingRepository&lt;Person, String&gt; {

    List&lt;Person&gt; findByName(String name);                              <b class="conum">(1)</b>

    Page&lt;Person&gt; findByName(String name, Pageable pageable);           <b class="conum">(2)</b>

    List&lt;Person&gt; findByNameStartsWith(String prefix);                  <b class="conum">(3)</b>

 }</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The method shows a query for all people with the given name. The query will be derived by parsing the method name
for constraints that can be concatenated with <code>And</code> and <code>Or</code>.</p>
</li>
<li>
<p>Applies pagination to a query. Just equip your method signature with a <code>Pageable</code> parameter and let the method
return a <code>Page</code> instance, and it will automatically page the query accordingly (i.e. return the required part of results).</p>
</li>
<li>
<p>Uses query-based partial name search.</p>
</li>
</ol>
</div>
</div>
</div>
<div id="aerospike.repositories.example" class="paragraph">
<p>Here&#8217;s a delete insert and query example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@ContextConfiguration(classes = TestRepositoryConfig.class)
public class RepositoryExample {

	@Autowired
	protected PersonRepository repository;
	@Autowired
	AerospikeOperations aerospikeOperations;
	@Autowired
	AerospikeClient client;

	public RepositoryExample(ApplicationContext ctx) {
		aerospikeOperations = ctx.getBean(AerospikeTemplate.class);
		repository = (PersonRepository) ctx.getBean("personRepository");
		client = ctx.getBean(AerospikeClient.class);
	}

	protected void setUp() {
		repository.deleteAll();
		Person dave = new Person("Dave-01", "Matthews", 42);
		Person donny = new Person("Dave-02", "Macintire", 39);
		Person oliver = new Person("Oliver-01", "Matthews", 4);
		Person carter = new Person("Carter-01", "Beauford", 49);
		Person boyd = new Person("Boyd-01", "Tinsley", 45);
		Person stefan = new Person("Stefan-01", "Lessard", 34);
		Person leroi = new Person("Leroi-01", "Moore", 41);
		Person leroi2 = new Person("Leroi-02", "Moore", 25);
		Person alicia = new Person("Alicia-01", "Keys", 30);
		repository.createIndex(Person.class, "person_name_index", "name",
				IndexType.STRING);
		List&lt;Person&gt; all = (List&lt;Person&gt;) repository.save(Arrays.asList(oliver,
				dave, donny, carter, boyd, stefan, leroi, leroi2, alicia));
	}

	protected void cleanUp() {
		repository.deleteAll();
	}

	protected void executeRepositoryCall() {
		List&lt;Person&gt; result = repository.findByName("Beauford");
		System.out.println("Results for exact match of 'Beauford'");
		for (Person person : result) {
			System.out.println(person.toString());
		}
		System.out.println("Results for name starting with letter 'M'");
		List&lt;Person&gt; resultPartial = repository.findByNameStartsWith("M");
		for (Person person : resultPartial) {
			System.out.println(person.toString());
		}
	}

	public static void main(String[] args) {
		ApplicationContext ctx = new AnnotationConfigApplicationContext(
				TestRepositoryConfig.class);
		RepositoryExample repositoryExample = new RepositoryExample(ctx);
		repositoryExample.setUp();
		repositoryExample.executeRepositoryCall();
		repositoryExample.cleanUp();
	}
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="aerospike.reactive.repositories">Reactive Aerospike Repositories</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="aerospike-reactive-repo-intro">Introduction</h3>
<div class="paragraph">
<p>This chapter will point out the specialties for reactive repository support for Aerospike. This builds on the core
repository support explained in <a href="#aerospike.repositories">repositories</a>. So make sure you&#8217;ve got
a sound understanding of the basic concepts explained there.</p>
</div>
</div>
<div class="sect2">
<h3 id="aerospike.reactive.repositories.libraries">Reactive Composition Libraries</h3>
<div class="paragraph">
<p>The reactive space offers various reactive composition libraries. The most common library is
<a href="https://projectreactor.io/">Project Reactor</a>.</p>
</div>
<div class="paragraph">
<p>Spring Data Aerospike is built on top of the
<a href="https://github.com/aerospike/aerospike-client-java-reactive">Aerospike Reactor Java Client Library</a>.
To provide maximal interoperability it relies on the <a href="https://www.reactive-streams.org/">Reactive Streams</a> initiative.
Static APIs, such as <code>ReactiveAerospikeOperations</code>, are provided by using Project Reactor&#8217;s <code>Flux</code> and <code>Mono</code> types.
Project Reactor offers various adapters to convert reactive wrapper types  (<code>Flux</code> to <code>Observable</code> and vice versa).</p>
</div>
<div class="paragraph">
<p>Spring Data&#8217;s Repository abstraction is a dynamic API, mostly defined by you and your requirements as you declare
query methods. Reactive Aerospike repositories can be implemented by using Project Reactor wrapper types
by extending from the following library-specific repository interface:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ReactiveAerospikeRepository</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="aerospike-reactive-repo-usage">Usage</h3>
<div class="paragraph">
<p>To access domain entities stored in an Aerospike you can use our sophisticated repository support that eases
implementing those quite significantly. To do so, create an interface similar to your repository.
Before you can do that, though, you need an entity, such as the entity defined in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 6. Sample <code>Person</code> entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class Person {

  @Id
  private String id;
  private String firstname;
  private String lastname;
  private Address address;

  //  getters and setters omitted
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>We have a quite simple domain object here. The default serialization mechanism used in <code>ReactiveAerospikeTemplate</code>
(which is backing the repository support) regards properties named id as document ID. Currently, we support
<code>String</code> and <code>long</code> as id-types. The following example shows how to create an interface that defines queries
against the <code>Person</code> object from the preceding example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 7. Basic repository interface to persist Person entities</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>public interface ReactivePersonRepository extends ReactiveAerospikeRepository&lt;Person, String&gt; {

  Flux&lt;Person&gt; findByFirstname(String firstname);

}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Right now this interface simply serves typing purposes but we will add additional methods to it later.</p>
</div>
<div class="paragraph">
<p>For Java configuration, use the <code>@EnableReactiveAerospikeRepositories</code> annotation. The annotation carries the base
packages attribute. These base packages are to be scanned for interfaces extending <code>ReactiveAerospikeRepository</code>
and create Spring beans for each of them found. If no base package is configured, the infrastructure scans the package
of the annotated configuration class.</p>
</div>
<div class="paragraph">
<p>The following listing shows how to use Java configuration for a repository:</p>
</div>
<div class="exampleblock">
<div class="title">Example 8. Java configuration for repositories</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Configuration
@EnableReactiveAerospikeRepositories(basePackages = "org.springframework.data.aerospike.example")
public class TestRepositoryConfig extends AbstractReactiveAerospikeDataConfiguration {
    @Override
    protected Collection&lt;Host&gt; getHosts() {
        return Collections.singleton(new Host("52.23.205.208", 3000));
    }

    @Override
    protected String nameSpace() {
        return "test";
    }

    @Override
    protected EventLoops eventLoops() {
        return new NioEventLoops();
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As our domain repository extends <code>ReactiveAerospikeRepository</code> it provides you with CRUD operations.
Working with the repository instance is a matter of dependency injecting it into a client, as the following example shows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 9. Access to Person entities</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration
public class PersonRepositoryTests {
    @Autowired
    ReactivePersonRepository repository;

    @Test
    public void findByFirstnameCorrectly() {
      Flux&lt;Person&gt; persons = repository.findByFirstname("TestFirstName");
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The sample creates an application context with Spring&#8217;s unit test support which will perform annotation-based
dependency injection into test cases. Inside the test method, we simply use the repository to query the datastore.</p>
</div>
</div>
<div class="sect2">
<h3 id="aerospike.reactive.repositories.queries">Query methods</h3>
<div class="paragraph">
<p>Most of the data access operations you usually trigger on a repository result in a query being executed against
the Aerospike databases. Defining such a query is just a matter of declaring a method on the repository interface</p>
</div>
<div class="exampleblock">
<div class="title">Example 10. PersonRepository with query methods</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public interface ReactivePersonRepository extends ReactiveAerospikeRepository&lt;Person, String&gt; {

  Flux&lt;Person&gt; findByFirstname(String firstname);                                   <b class="conum">(1)</b>

  Flux&lt;Person&gt; findByFirstname(Publisher&lt;String&gt; firstname);                        <b class="conum">(2)</b>

  Mono&lt;Person&gt; findByFirstnameAndLastname(String firstname, String lastname);       <b class="conum">(3)</b>

  Mono&lt;Person&gt; findFirstByLastname(String lastname);                                <b class="conum">(4)</b>

  Flux&lt;Person&gt; findByFirstnameStartsWith(String prefix);                            <b class="conum">(5)</b>

}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The method shows a query for all people with the given <code>firstname</code>. The query is derived by parsing
the method name for constraints that can be concatenated with <code>And</code> and <code>Or</code>.
Thus, the method name results in a query expression of <code>{"firstname" : firstname}</code>.</p>
</li>
<li>
<p>The method shows a query for all people with the given <code>firstname</code> once the <code>firstname</code> is emitted
by the given <code>Publisher</code>.</p>
</li>
<li>
<p>Find a single entity for the given criteria. It completes with <code>IncorrectResultSizeDataAccessException</code>
on non-unique results.</p>
</li>
<li>
<p>Unless &lt;3&gt;, the first entity is always emitted even if the query yields more result documents.</p>
</li>
<li>
<p>The method shows a query for all people with the firstname starts from <code>prefix</code></p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="aerospike.reactive.repositories.example">Examples</h3>
<div class="paragraph">
<p>Here&#8217;s a delete, insert and query example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@ContextConfiguration(classes = TestRepositoryConfig.class)
public class ReactiveRepositoryExample {

    @Autowired
    protected ReactivePersonRepository repository;
    @Autowired
    ReactiveAerospikeOperations aerospikeOperations;
    @Autowired
    IAerospikeReactorClient client;

    public RepositoryExample(ApplicationContext ctx) {
        aerospikeOperations = ctx.getBean(ReactiveAerospikeTemplate.class);
        repository = (ReactivePersonRepository) ctx.getBean("reactivePersonRepository");
        client = ctx.getBean(IAerospikeReactorClient.class);
    }

    protected void setUp() {
        // Insert new Person items into repository
        Person dave = new Person("Dave-01", "Matthews", 42);
        Person donny = new Person("Dave-02", "Macintire", 39);
        Person oliver = new Person("Oliver-01", "Matthews", 4);
        Person carter = new Person("Carter-01", "Beauford", 49);
        List&lt;Person&gt; all = saveAll(Arrays.asList(dave, donny, oliver, carter))
            .collectList().block();
    }

    protected void cleanUp() {
        // Delete all Person items from repository
        repository.findAll().flatMap(a -&gt; repository.delete(a)).blockLast();
    }

    protected void executeRepositoryCall() {
        System.out.println("Results for first name exact match of 'Dave-02'");
        repository.findByFirstname("Dave-02")
            .doOnNext(person -&gt; System.out.println(person.toString())).blockLast();

        System.out.println("Results for first name starting with letter 'D'");
        repository.findByFirstnameStartsWith("D")
            .doOnNext(person -&gt; System.out.println(person.toString())).blockLast();
    }

    public static void main(String[] args) {
        ApplicationContext ctx =
            new AnnotationConfigApplicationContext(TestRepositoryConfig.class);
        ReactiveRepositoryExample repositoryExample = new ReactiveRepositoryExample(ctx);
        repositoryExample.setUp();
        repositoryExample.executeRepositoryCall();
        repositoryExample.cleanUp();
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_restrictions">Restrictions</h3>
<div class="paragraph">
<p><code>ReactiveAerospikeRepository</code> currently does not support the next operations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>all operations with indexes (create, delete, exists)</p>
</li>
<li>
<p>count()</p>
</li>
<li>
<p>deleteAll()</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This limitation is due to the lack of corresponding asynchronous methods in the Aerospike client.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="aerospike.projections">Projections with Aerospike</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Data Aerospike supports Projections, a mechanism that allows you to fetch only relevant fields from Aerospike for a particular use case. This results in better performance, less network traffic, and a better understanding of what is required for the rest of the flow.</p>
</div>
<div class="paragraph">
<p>For more details, refer to Spring Data documentation: <a href="https://docs.spring.io/spring-data/rest/reference/data-commons/repositories/projections.html">Projections</a>.</p>
</div>
<div class="paragraph">
<p>For example, consider a Person class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@AllArgsConstructor
@NoArgsConstructor
@Data
@Document
public class Person {
    public enum Gender {
        MALE, FEMALE;
    }
    @Id
    private long id;
    private String firstName;
    @Indexed(name = "lastName_idx", type = IndexType.STRING)
    private String lastName;
    @Field("dob")
    private Date dateOfBirth;
    private long heightInCm;
    private boolean enabled;
    private Gender gender;
    private String hairColor;
    private String eyeColor;
    private String passportNo;
    private String passptCnty;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is a moderately complex object, and a production object is likely to be more complex. The use case might call for a search box that shows the <code>firstName</code>, <code>lastName</code> and <code>dateOfBirth</code> fields, allowing the user to select a <code>Person</code> based on the criteria upon which the full object will be shown.</p>
</div>
<div class="paragraph">
<p>A simple projection of this object might be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Data
@Builder
public class SearchPerson {
    private String firstName;
    private String lastName;
    @Field("dob")
    private Date dateOfBirth;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To tell Spring Data how to create a <code>SearchPerson</code> it is necessary to create a method on the <code>Person</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public SearchPerson toSearchPerson() {
    return SearchPerson.builder()
            .firstName(this.getFirstName())
            .lastName(this.getLastName())
            .dateOfBirth(this.getDateOfBirth())
            .build();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now the repository interface can be extended to return this projection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public interface PersonRepository extends AerospikeRepository&lt;Person, Long&gt; {
    public List&lt;Person&gt; findByLastName(String lastName);
    public List&lt;SearchPerson&gt; findSearchPersonByLastName(String lastName);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that the method name now dictates the return type of <code>SearchPerson</code> as well as changing the return value. When this method is executed, Aerospike loads the full <code>Person</code> objects out of storage, invokes the <code>toSearchPerson</code> on each person and returns the resulting <code>SearchPerson</code> instances. This reduces the required network bandwidth to present these objects to the front end and simplifies logic.</p>
</div>
<div class="paragraph">
<p>A blog post with more details on projections can be found <a href="https://medium.com/aerospike-developer-blog/spring-data-aerospike-projections-951382bc07b5">here</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="aerospike.query-methods-preface">Query Methods</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Data Aerospike supports defining queries by method names in the Repository interface so that the implementation
is generated.
The format of method names is fairly flexible, comprising a verb and criteria.</p>
</div>
<div class="paragraph">
<p>Some of the verbs include <code>find</code>, <code>query</code>, <code>read</code>, <code>get</code>, <code>count</code> and <code>delete</code>.
For example, queries might look like <code>findByFirstName</code>, <code>countByLastName</code> etc.</p>
</div>
<div class="paragraph">
<p>For more details, refer to basic Spring Data documentation:
<a href="https://docs.spring.io/spring-data/rest/reference/data-commons/repositories/query-methods-details.html">Defining Query Methods</a>.</p>
</div>
<div class="sect2">
<h3 id="_using_secondary_index">Using Secondary Index</h3>
<div class="paragraph">
<p>Repository queries in Spring Data Aerospike can be divided into 3 groups:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Queries that utilize secondary index (if at least one corresponding index is available)</p>
</li>
<li>
<p>Queries that only use <a href="#aerospike.scan-operation">scan operation</a></p>
</li>
<li>
<p>Queries that use both secondary index and scan (when looking for a nested property).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If no corresponding secondary index is found, each query does a fallback to using scan only.</p>
</div>
<div class="paragraph">
<p>For details on particular repository queries see the tables referring to queries examples below.</p>
</div>
</div>
<div class="sect2">
<h3 id="_repository_query_keywords">Repository Query Keywords</h3>
<div class="paragraph">
<p>Here are the references to the examples of repository queries:</p>
</div>
<div class="paragraph">
<p><a href="#aerospike.query_methods.simple_property">Simple property queries</a></p>
</div>
<div class="paragraph">
<p><a href="#aerospike.query_methods.collection">Collection queries</a></p>
</div>
<div class="paragraph">
<p><a href="#aerospike.query_methods.map">Map queries</a></p>
</div>
<div class="paragraph">
<p><a href="#aerospike.query_methods.pojo">POJO queries</a></p>
</div>
<div class="paragraph">
<p><a href="#aerospike.query_methods.id">Id queries</a></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<strong>Repository read queries featuring id equality</strong> (e.g., <code>findById()</code>, <code>findByIds()</code>, <code>findByFirstNameAndId()</code>, <code>findAllById()</code>,
<code>countById()</code>, <code>existsById()</code> etc.) utilize <code>get()</code> operation of the underlying Java client.
<strong>Repository read queries without id or with 'string id like'</strong> (e.g., <code>findByFirstName()</code>, <code>findByFirstNameAndLastName()</code>, <code>findAll()</code> , <code>findByIdLike()</code> etc.)
utilize <code>query()</code> operation of the underlying Java client.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_repository_interface_example">Repository Interface Example</h3>
<div class="paragraph">
<p>Below is an example of an interface with several query methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public interface PersonRepository extends AerospikeRepository&lt;Person, Long&gt; {
    List&lt;Person&gt; findByLastName(String lastName);
    List&lt;Person&gt; findByLastNameContaining(String lastName);
    List&lt;Person&gt; findByLastNameStartingWith(String lastName);
    List&lt;Person&gt; findByLastNameAndFirstNameContaining(String lastName, String firstName);
    List&lt;Person&gt; findByAgeBetween(long startAge, long endAge);
    Optional&lt;Person&gt; findById(Long id);
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="aerospike.query_methods.simple_property">Simple Property Repository Queries</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<strong>Simple property repository queries</strong> utilize <code>query()</code> operation of the underlying Java client.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 7.6086%;">
<col style="width: 32.6086%;">
<col style="width: 27.1739%;">
<col style="width: 10.8695%;">
<col style="width: 21.7394%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Keyword</th>
<th class="tableblock halign-left valign-top">Repository query sample</th>
<th class="tableblock halign-left valign-top">Snippet</th>
<th class="tableblock halign-left valign-top">Uses secondary index</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Is, Equals</p>
<p class="tableblock">or no keyword</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByLastName(String lastName)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.lastName = ?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only for integers, strings and byte arrays</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Both secondary index and scan are used for queries featuring nested integer or string property, e.g. <code>findByFriendAddressZipCode()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not, IsNot</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByLastNameNot(String lastName)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.lastName &lt;&gt; ?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only scan</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">True, isTrue</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByEnabledTrue()</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.enabled = true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only scan</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Currently there is no secondary index for a boolean bin</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">False, isFalse</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByEnabledFalse()</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.enabled = false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only scan</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Currently there is no secondary index for a boolean bin</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">In, IsIn</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByLastNameIn(Collection&lt;String&gt;)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.lastName in ?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only for integers, strings and byte arrays</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NotIn, IsNotIn</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByLastNameNotIn(Collection&lt;String&gt;)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.lastName not in ?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only scan</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Null, IsNull</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByEmailAddressIsNull()</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.emailAddress = null or x.emailAddress does not exist</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only scan</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The same as "does not exist", objects and fields exist in AerospikeDB when their value is not equal to null.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exists</p>
<p class="tableblock">NotNull, IsNotNull</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByEmailAddressExists()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByEmailAddressNotNull()</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.emailAddress != null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only scan</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Exists" and "IsNotNull" represent the same functionality and can be used interchangeably, objects and fields
exist in AerospikeDB when their value is not equal to null.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LessThan, IsLessThan</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByAgeLessThan(int age)

findByFirstNameLessThan(String string)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.age &lt; ?</p>
<p class="tableblock">&#8230;&#8203;where x.firstName &lt; ?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only for integers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Strings are compared by order of each byte, assuming they have UTF-8 encoding.
See <a href="https://docs.aerospike.com/server/guide/data-types/cdt-ordering#string">information about ordering</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LessThanEqual, IsLessThanEqual</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByAgeLessThanEqual(int age)

findByFirstNameLessThanEqual(String string)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.age &lt; = ?</p>
<p class="tableblock">&#8230;&#8203;where x.firstName &lt; = ?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only for integers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Strings are compared by order of each byte, assuming they have UTF-8 encoding.
See <a href="https://docs.aerospike.com/server/guide/data-types/cdt-ordering#string">information about ordering</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GreaterThan, IsGreaterThan</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByAgeGreaterThan(int age)

findByFirstNameGreaterThan(String string)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.age &gt; ?</p>
<p class="tableblock">&#8230;&#8203;where x.firstName &gt; ?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only for integers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Strings are compared by order of each byte, assuming they have UTF-8 encoding.
See <a href="https://docs.aerospike.com/server/guide/data-types/cdt-ordering#string">information about ordering</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GreaterThanEqual, IsGreaterThanEqual</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByAgeGreaterThanEqual(int age)

findByFirstNameGreaterThanEqual(String string)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.age &gt;= ?</p>
<p class="tableblock">&#8230;&#8203;where x.firstName &gt;= ?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only for integers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Strings are compared by order of each byte, assuming they have UTF-8 encoding.
See <a href="https://docs.aerospike.com/server/guide/data-types/cdt-ordering#string">information about ordering</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Between, IsBetween</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByAgeBetween(int lowerLimit, int upperLimit)

findByFirstNameBetween(String lowerLimit, String upperLimit)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.age between ? and ?</p>
<p class="tableblock">&#8230;&#8203;where x.firstName between ? and ?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only for integers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Strings are compared by order of each byte, assuming they have UTF-8 encoding.
See <a href="https://docs.aerospike.com/server/guide/data-types/cdt-ordering#string">information about ordering</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Before, IsBefore</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByDateOfBirthBefore(Date date)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.dateOfBirth &lt; ?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">After, IsAfter</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByDateOfBirthAfter(Date date)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.dateOfBirth &gt; ?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">StartingWith, IsStartingWith, StartsWith</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByLastNameStartingWith(String string)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.lastName like 'abc%'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only scan</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EndingWith, IsEndingWith, EndsWith</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByLastNameEndingWith(String string)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.lastName like '%abc'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only scan</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Like, IsLike, MatchesRegex</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByLastNameLike(String lastNameRegex)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.lastName like ?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only scan</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Containing, IsContaining, Contains</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByLastNameContaining(String substring)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.lastName like '%abc%'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only scan</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NotContaining, IsNotContaining, NotContains</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByLastNameNotContaining(String substring)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.lastName not like '%abc%'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only scan</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">And</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByLastNameAndFirstName(String lastName, String firstName)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.lastName = ? and x.firstName = ?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">depending on each part of query</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Or</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByLastNameOrFirstName(String lastName, String firstName)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.lastName = ? or x.firstName = ?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">depending on each part of query</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="aerospike.query_methods.collection">Collection Repository Queries</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<strong>Collection repository queries</strong> utilize <code>query()</code> operation of the underlying Java client.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 7.6086%;">
<col style="width: 32.6086%;">
<col style="width: 27.1739%;">
<col style="width: 10.8695%;">
<col style="width: 21.7394%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Keyword</th>
<th class="tableblock halign-left valign-top">Repository query sample</th>
<th class="tableblock halign-left valign-top">Snippet</th>
<th class="tableblock halign-left valign-top">Uses secondary index</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Is, Equals</p>
<p class="tableblock">or no keyword</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByStringList(Collection&lt;String&gt; stringList)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.stringList = ?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only scan</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not, IsNot</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByStringListNot(Collection&lt;String&gt; stringList)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.stringList &lt;&gt; ?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only scan</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">In</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByStringListIn(Collection&lt;Collection&lt;String&gt;&gt;)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.stringList in ?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only scan</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Find records where <code>stringList</code> bin value equals one of the collections in the given argument.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not In</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByStringListNotIn(Collection&lt;Collection&lt;String&gt;&gt;)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.stringList not in ?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only scan</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Find records where <code>stringList</code> bin value is not equal to any of the collections in the given argument.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Null, IsNull</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByStringListIsNull()</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.stringList = null or x.stringList does not exist</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only scan</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The same as "does not exist", objects and fields exist in AerospikeDB when their value is not equal to null.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exists</p>
<p class="tableblock">NotNull, IsNotNull</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByStringListExists()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByStringListNotNull()</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.stringList != null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only scan</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">("Exists" and "IsNotNull" represent the same functionality and can be used interchangeably, objects and fields
exist in AerospikeDB when their value is not equal to null).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LessThan, IsLessThan</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByStringListLessThan(Collection&lt;String&gt; stringList)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.stringList &lt; ?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only scan</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Find records where <code>stringList</code> bin value has fewer elements or has a corresponding element lower in ordering
than in the given argument.
See <a href="https://docs.aerospike.com/server/guide/data-types/cdt-ordering#list">information about ordering</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LessThanEqual, IsLessThanEqual</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByStringListLessThanEqual(Collection&lt;String&gt; stringList)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.stringList &lt; = ?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only scan</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Find records where <code>stringList</code> bin value has smaller or the same amount of elements or has each
corresponding element lower in ordering or the same as in the given argument.
See <a href="https://docs.aerospike.com/server/guide/data-types/cdt-ordering#list">information about ordering</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GreaterThan, IsGreaterThan</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByStringListGreaterThan(Collection&lt;String&gt; stringList)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.stringList &gt; ?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only scan</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Find records where <code>stringList</code> bin value has more elements or has a corresponding element higher in ordering
than in the given argument.
See <a href="https://docs.aerospike.com/server/guide/data-types/cdt-ordering#list">information about ordering</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GreaterThanEqual, IsGreaterThanEqual</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByStringListGreaterThanEqual(Collection&lt;String&gt; stringList)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.stringList &gt;= ?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only scan</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Find records where <code>stringList</code> bin value has larger or the same amount of elements or has each
corresponding element higher in ordering or the same as in the given argument.
See <a href="https://docs.aerospike.com/server/guide/data-types/cdt-ordering#list">information about ordering</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Between, IsBetween</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByStringListBetween(Collection&lt;String&gt; lowerLimit, Collection&lt;String&gt; upperLimit)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.stringList between ? and ?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only scan</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Find records where <code>stringList</code> bin value is in the range between the given arguments.
See <a href="https://docs.aerospike.com/server/guide/data-types/cdt-ordering#list">information about ordering</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Containing, IsContaining, Contains</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByStringListContaining(String string)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.stringList contains ?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only scan</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NotContaining, IsNotContaining, NotContains</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByStringListNotContaining(String string)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.stringList not contains ?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only scan</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">And</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByStringListAndIntList(QueryParam stringList, QueryParam intList)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.stringList = ? and x.intList = ?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only scan</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Or</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByStringListOrIntList(QueryParam stringList, QueryParam intList)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.stringList = ? or x.intList = ?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only scan</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="aerospike.query_methods.map">Map Repository Queries</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<strong>Map repository queries</strong> utilize <code>query()</code> operation of the underlying Java client.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 7.6086%;">
<col style="width: 32.6086%;">
<col style="width: 27.1739%;">
<col style="width: 10.8695%;">
<col style="width: 21.7394%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Keyword</th>
<th class="tableblock halign-left valign-top">Repository query sample</th>
<th class="tableblock halign-left valign-top">Snippet</th>
<th class="tableblock halign-left valign-top">Uses secondary index</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Is, Equals</p>
<p class="tableblock">or no keyword</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByStringMap(Map&lt;String, String&gt; stringMap)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.stringMap = ?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only scan</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not, IsNot</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByStringMapNot(Map&lt;String, String&gt; stringMap)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.stringMap &lt;&gt; ?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only scan</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">In</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByStringMapIn(Collection&lt;Map&lt;String, String&gt;&gt;)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.stringMap in ?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only scan</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Find records where <code>stringMap</code> bin value equals one of the maps in the given argument.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not In</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByStringMapNotIn(Collection&lt;Map&lt;String, String&gt;&gt;)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.stringMap not in ?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only scan</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Find records where <code>stringMap</code> bin value is not equal to any of the maps in the given argument.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Null, IsNull</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByStringMapIsNull()</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.stringMap = null or x.stringMap does not exist</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only scan</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The same as "does not exist", objects and fields exist in AerospikeDB when their value is not equal to null.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exists</p>
<p class="tableblock">NotNull, IsNotNull</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByStringMapExists()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByStringMapNotNull()</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.stringMap != null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only scan</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Exists" and "IsNotNull" represent the same functionality and can be used interchangeably, objects and fields exist
when their value is not equal to null.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LessThan, IsLessThan</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByStringMapLessThan(Map&lt;String, String&gt; stringMap)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.stringMap &lt; ?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only scan</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Find records where <code>stringMap</code> bin value has fewer elements or has a corresponding element lower in ordering than
in the given argument. See <a href="https://docs.aerospike.com/server/guide/data-types/cdt-ordering#map">information about ordering</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LessThanEqual, IsLessThanEqual</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByStringMapLessThanEqual(Map&lt;String, String&gt; stringMap)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.stringMap &lt; = ?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only scan</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Find records where <code>stringMap</code> bin value has smaller or the same amount of elements or has each corresponding element
lower in ordering or the same as in the given argument.
See <a href="https://docs.aerospike.com/server/guide/data-types/cdt-ordering#map">information about ordering</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GreaterThan, IsGreaterThan</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByStringMapGreaterThan(Map&lt;String, String&gt; stringMap)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.stringMap &gt; ?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only scan</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Find records where <code>stringMap</code> bin value has more elements or has a corresponding element higher in ordering than
in the given argument. See <a href="https://docs.aerospike.com/server/guide/data-types/cdt-ordering#map">information about ordering</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GreaterThanEqual, IsGreaterThanEqual</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByStringMapGreaterThanEqual(Map&lt;String, String&gt; stringMap)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.stringMap &gt;= ?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only scan</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Find records where <code>stringMap</code> bin value has larger or the same amount of elements or has each corresponding element
higher in ordering or the same as in the given argument.
See <a href="https://docs.aerospike.com/server/guide/data-types/cdt-ordering#map">information about ordering</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Between, IsBetween</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByStringMapBetween(Map&lt;String, String&gt; lowerLimit, Map&lt;String, String&gt; upperLimit)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.stringMap between ? and ?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only scan</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Find records where <code>stringMap</code> bin value is in the range between the given arguments.
See <a href="https://docs.aerospike.com/server/guide/data-types/cdt-ordering#map">information about ordering</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Containing, IsContaining, Contains</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByStringMapContaining(AerospikeQueryCriterion criterion, String string)

findByStringMapContaining(AerospikeQueryCriterion criterionPair, String string, String value)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.stringMap contains ?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only scan</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Find records where <code>stringMap</code> bin value (which is a Map) contains key "key1":</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>findByStringMapContaining(KEY, "key1")</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Find records where <code>stringMap</code> bin value (which is a Map) contains value "value1":</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>findByStringMapContaining(VALUE, "value1")</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Find records where <code>stringMap</code> bin value (which is a Map) contains key "key1" with the value "value1":</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>findByStringMapContaining(KEY_VALUE_PAIR, "key1", "value1")</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NotContaining, IsNotContaining, NotContains</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByStringNameNotContaining(AerospikeQueryCriterion criterion, String string)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.stringMap not contains ?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only scan</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByStringMapNotContaining(KEY, "key1")</code></p>
<p class="tableblock"><code>findByStringMapNotContaining(VALUE, "value1")</code></p>
<p class="tableblock"><code>findByStringMapNotContaining(KEY_VALUE_PAIR, "key1", "value1")</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">And</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByStringMapAndIntMap(QueryParam stringMap, QueryParam intMap)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.stringMap = ? and x.intMap = ?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only scan</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Or</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByStringMapOrIntMap(QueryParam stringMap, QueryParam intMap)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.stringMap = ? or x.intMap = ?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only scan</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="aerospike.query_methods.pojo">POJO Repository Queries</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<strong>These repository queries</strong> utilize <code>query()</code> operation of the underlying Java client.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 7.6086%;">
<col style="width: 32.6086%;">
<col style="width: 27.1739%;">
<col style="width: 10.8695%;">
<col style="width: 21.7394%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Keyword</th>
<th class="tableblock halign-left valign-top">Repository query sample</th>
<th class="tableblock halign-left valign-top">Snippet</th>
<th class="tableblock halign-left valign-top">Uses secondary index</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Is, Equals</p>
<p class="tableblock">or no keyword</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByAddress(Address address)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.address = ?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only scan</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not, IsNot</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByAddressNot(Address address)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.address &lt;&gt; ?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only scan</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">In</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByAddressIn(Collection&lt;Address&gt;)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.address in ?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only scan</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Find records where <code>address</code> bin value equals one of the Address objects in the given argument.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not In</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByAddressNotIn(Collection&lt;Address&gt;)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.address not in ?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only scan</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Find records where <code>address</code> bin value is not equal to any of the Address objects in the given argument.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Null, IsNull</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByAddressIsNull()</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.address = null or x.address does not exist</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only scan</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The same as "does not exist", objects and fields exist in AerospikeDB when their value is not equal to null.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exists</p>
<p class="tableblock">NotNull, IsNotNull</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByAddressExists()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByAddressNotNull()</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.address != null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only scan</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Exists" and "IsNotNull" represent the same functionality and can be used interchangeably, objects and fields exist
when their value is not equal to null.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LessThan, IsLessThan</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByAddressLessThan(Address address)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.address &lt; ?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only scan</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Find records where <code>address</code> bin value (POJOs are stored in AerospikeDB as maps) has fewer elements or has
a corresponding element lower in ordering than in the given argument.
See <a href="https://docs.aerospike.com/server/guide/data-types/cdt-ordering#map">information about ordering</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LessThanEqual, IsLessThanEqual</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByAddressLessThanEqual(Address address)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.address &lt; = ?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only scan</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Find records where <code>address</code> bin value (POJOs are stored in AerospikeDB as maps) has smaller or the same amount of
elements or has each corresponding element lower in ordering or the same as in the given argument.
See <a href="https://docs.aerospike.com/server/guide/data-types/cdt-ordering#map">information about ordering</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GreaterThan, IsGreaterThan</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByAddressGreaterThan(Address address)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.address &gt; ?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only scan</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Find records where <code>address</code> bin value (POJOs are stored in AerospikeDB as maps) has more elements or has
a corresponding element higher in ordering than in the given argument.
See <a href="https://docs.aerospike.com/server/guide/data-types/cdt-ordering#map">information about ordering</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GreaterThanEqual, IsGreaterThanEqual</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByAddressGreaterThanEqual(Address address)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.address &gt;= ?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only scan</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Find records where <code>address</code> bin value (POJOs are stored in AerospikeDB as maps) has larger or the same amount
of elements or has each corresponding element higher in ordering or the same as in the given argument.
See <a href="https://docs.aerospike.com/server/guide/data-types/cdt-ordering#map">information about ordering</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Between, IsBetween</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByAddressBetween(Address lowerLimit, Address upperLimit)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.address between ? and ?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only scan</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Find records where <code>address</code> bin value (POJOs are stored in AerospikeDB as maps) is in the range between
the given arguments. See <a href="https://docs.aerospike.com/server/guide/data-types/cdt-ordering#map">information about ordering</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">And</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByAddressAndFriend(QueryParam address, QueryParam friend)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.address = ? and x.friend = ?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only scan</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Or</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByAddressOrFriend(QueryParam address, QueryParam friend)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.address = ? or x.friend = ?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only scan</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="aerospike.query_methods.id">Id Repository Queries</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Repository reading queries featuring id equality</strong> (like <code>findById()</code>, <code>findByIds()</code>, <code>findByFirstNameAndId()</code>, <code>findAllById()</code>,
<code>countById()</code>, <code>existsById()</code> etc.) utilize <code>get</code> operation of the underlying Java client (<code>client.get()</code>).</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 7.6086%;">
<col style="width: 32.6086%;">
<col style="width: 27.1739%;">
<col style="width: 10.8695%;">
<col style="width: 21.7394%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Keyword</th>
<th class="tableblock halign-left valign-top">Repository query sample</th>
<th class="tableblock halign-left valign-top">Snippet</th>
<th class="tableblock halign-left valign-top">Uses secondary index</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">no keyword</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findById(String id)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.PK = ?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uses primary key directly</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This query utilizes <code>get</code> operation of Java client</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Like</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByIdLike(String idPattern)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.PK like ?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only scan</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>idPattern</code> must be a String. This query utilizes <code>query</code> operation of Java client</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">And</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">findByIdAndFirstName(QueryParam ids, QueryParam firstName)

findByIdLikeAndFirstName(QueryParam id, QueryParam firstName)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.PK = ? and x.firstName = ?</p>
<p class="tableblock">&#8230;&#8203;where x.PK like ? and x.firstName = ?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">depending on each part of query</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="aerospike.query-methods-combined">Combined Query Methods</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In Spring Data, complex query methods using <code>And</code> or <code>Or</code> conjunction allow developers to define custom
database queries based on method names that combine multiple conditions. These methods leverage query derivation,
enabling developers to create expressive and type-safe queries by simply defining method signatures.</p>
</div>
<div class="paragraph">
<p>For more details,
see <a href="https://docs.spring.io/spring-data/commons/reference/repositories/query-methods-details.html">Defining Query Methods</a>.</p>
</div>
<div class="paragraph">
<p>For instance, a method like <code>findByFirstNameAndLastName</code> will fetch records matching both conditions,
while <code>findByFirstNameOrLastName</code> will return records that match either condition. These query methods simplify
database interaction by reducing boilerplate code and relying on convention over configuration for readability
and maintainability.</p>
</div>
<div class="paragraph">
<p>In Spring Data Aerospike you define such queries by adding query methods signatures to a <code>Repository</code>, as you would
typically, wrapping each query parameter with <code>QueryParam.of()</code> method. This method is required to pass arguments
to each part of a combined query, it can receive one or more objects of the same type.</p>
</div>
<div class="paragraph">
<p>This way <code>QueryParam</code> stores arguments passed to each part of a combined repository query, e.g.,
<code>repository.findByNameAndEmail(QueryParam.of("John"), QueryParam.of("email"))</code>.</p>
</div>
<div class="paragraph">
<p>Here are some examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public interface CustomerRepository extends AerospikeRepository&lt;Customer, String&gt; {

     // simple query
    List&lt;Customer&gt; findByLastName(String lastName);

     // simple query
    List&lt;Customer&gt; findByFirstName(String firstName);

    // combined query with AND conjunction
    List&lt;Customer&gt; findByEmailAndFirstName(QueryParam email, QueryParam firstName);

    // combined query with AND conjunctions
    List&lt;Customer&gt; findByIdAndFirstNameAndAge(QueryParam id, QueryParam firstName, QueryParam age);

    // combined query with OR conjunction
    List&lt;Consumer&gt; findByFirstNameOrAge(QueryParam firstName, QueryParam age);

    // combined query with AND and OR conjunctions
    List&lt;Consumer&gt; findByEmailAndFirstNameOrAge(QueryParam email, QueryParam firstName, QueryParam age);
}

    @Test
    void findByCombinedQuery() {
        QueryParam email = QueryParam.of(dave.getEmail());
        QueryParam name = QueryParam.of(carter.getFirstName());
        List&lt;Customer&gt; customers = repository.findByEmailAndFirstName(email, name);
        assertThat(customers).isEmpty();

        QueryParam ids = QueryParam.of(List.of(leroi.getId(), dave.getId(), carter.getId()));
        QueryParam firstName = QueryParam.of(leroi.getFirstName());
        QueryParam age = QueryParam.of(leroi.getAge());
        List&lt;Customer&gt; customers2 = repository.findByIdAndFirstNameAndAge(ids, firstName, age);
        assertThat(customers).containsOnly(leroi);
    }</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_combined_queries_and_secondary_index">Combined Queries and Secondary Index</h3>
<div class="paragraph">
<p>There are certain rules applied to processing such queries regarding secondary index in Spring Data Aerospike:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If no query parts correspond to a secondary index, a <a href="#aerospike.scan-operation">scan operation</a> is used</p>
</li>
<li>
<p>If only one part of a query has a corresponding secondary index eligible for use, that index will be used. For instance, if an index was created for the <code>name</code> String bin, then it will be used in queries like <code>findByNameAndJob()</code>, <code>findByNameAndJobAndEmail()</code>, <code>findByJobAndName()</code> etc.</p>
</li>
<li>
<p>If two or more query parts have corresponding secondary indexes eligible for use, one index will be chosen based on cardinality.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_secondary_indexes_cardinality">Secondary Indexes Cardinality</h4>
<div class="paragraph">
<p>Cardinality is calculated the following way: when indexes info is retrieved (configurable, typically on startup and then once an hour), Spring Data Aerospike uses <code>sindex-stat</code> command to gather statistics for secondary indexes to look at the ratio of entries to unique bin values for a given secondary index on the node (<code>entries_per_bval</code>), which is used as cardinality based on distribution of data within the secondary index.</p>
</div>
<div class="paragraph">
<p>So when a query has more than one SI, cardinality of each query part (qualifier) is compared using cache of indexes, and the index with the lowest ratio of entries to unique bin values is selected. If two or more parts have the same cardinality, the first of them will be used.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="query-methods-modification">Query Modification</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_query_modifiers">Query Modifiers</h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 13.0434%;">
<col style="width: 27.1739%;">
<col style="width: 32.6086%;">
<col style="width: 27.1741%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Keyword</th>
<th class="tableblock halign-left valign-top">Sample</th>
<th class="tableblock halign-left valign-top">Snippet</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IgnoreCase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">findByLastNameIgnoreCase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where UPPER(x.lastName) = UPPER(?)</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OrderBy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">findByLastNameOrderByFirstNameDesc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;where x.lastName = ? order by x.firstName desc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ordering is done applicatively in Spring Data Aerospike as post-processing of the query results.
If there is a secondary index created for the ordering bin (in this example <code>firstName</code>), it is not used,
indexes are relevant only for the main query part before <code>OrderBy</code>.
Ordering affects performance depending on the amount of query results</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_limiting_query_results">Limiting Query Results</h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 17.9104%;">
<col style="width: 37.3134%;">
<col style="width: 44.7762%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Keyword</th>
<th class="tableblock halign-left valign-top">Sample</th>
<th class="tableblock halign-left valign-top">Snippet</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">First</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">findFirstByAge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">select top 1 where x.age = ?</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">First N</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">findFirst3ByAge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">select top 3  where x.age = ?</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">findTopByLastNameStartingWith</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">select top 1 where x.lastName like 'abc%' = ?</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top N</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">findTop4ByLastNameStartingWith</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">select top 4  where x.lastName like 'abc%'</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Distinct</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">findDistinctByFirstNameContaining</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">select distinct &#8230;&#8203; where x.firstName like 'abc%'</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Query result limiting is performed in Spring Data Aerospike at the application level as a
post-processing step. This limiting can affect performance, depending on the number of query
results and limiting parameters.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="custom-queries">Custom Queries</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="custom-queries-intro">Introduction</h3>
<div class="paragraph">
<p>Regular repository queries are obviously helpful for most of the querying tasks. Each of the repositories adds more functionality by providing its query methods.</p>
</div>
<div class="paragraph">
<p>There are some cases, however, when data finding tasks require building query methods which are more complex, more flexible or unsupported in a standard repository. Custom queries is such a special mechanism in Spring Data Aerospike. Currently only finding (reading) queries are supported.</p>
</div>
</div>
<div class="sect2">
<h3 id="find-using-query">Find Using Query</h3>
<div class="paragraph">
<p>User can perform a custom <code>Query</code> using a special custom <code>Qualifier</code> which represents an expression.
It may contain other qualifiers and combine them using either <code>AND</code> or <code>OR</code>, with some limitations due to Qualifier type.</p>
</div>
<div class="paragraph">
<p>Custom <code>Qualifier</code> can be created for queries of the following types: regular (Aerospike bins), metadata, DSL expression, indexed with expression and ids (primary keys).
Below are examples for the mentioned custom queries types.</p>
</div>
</div>
<div class="sect2">
<h3 id="custom-query-regular">Regular Custom Query Example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    // Creating an expression "firsName is equal to John"
    Qualifier firstNameEqJohn = Qualifier.builder() // Regular qualifier
        .setPath("firstName")
        .setFilterOperation(FilterOperation.EQ)
        .setValue("John")
        .build();
    result = repository.findUsingQuery(new Query(firstNameEqJohn));
    assertThat(result).containsOnly(john);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="custom-query-id">ID Custom Query Example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    // Creating an expression "primary key is equal to person's id"
    Qualifier keyEqJohnsId = Qualifier.idEquals(john.getId()); // Id qualifier
    result = repository.findUsingQuery(new Query(keyEqJohnsId));
    assertThat(result).containsOnly(john);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="custom-query-metadata">Metadata Custom Query Example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    // creating an expression "since_update_time metadata value is less than 50 seconds"
    Qualifier sinceUpdateTimeLt50Seconds = Qualifier.metadataBuilder() // Metadata qualifier
        .setMetadataField(SINCE_UPDATE_TIME)
        .setFilterOperation(FilterOperation.LT)
        .setValue(50000L)
        .build();
    result = repository.findUsingQuery(new Query(sinceUpdateTimeLt50Seconds));
    assertThat(result).contains(john);

    // expressions are combined using AND
    result = repository.findUsingQuery(new Query(Qualifier.and(firstNameEqJohn, keyEqJohnsId, sinceUpdateTimeLt50Seconds)));
    assertThat(result).containsOnly(john);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="custom-query-dsl-expression">DSL expression Custom Query Example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    // DSL expression qualifier
    Qualifier firstNameAndAge = Qualifier.dslExpressionBuilder()
            // Using a comprehensive static DSL expression with fixed values
            .setDSLExpressionString("$.firstName == 'Leroi' and $.age &gt;= 25 and $.age &lt; 45")
            .build();
        Query query = new Query(firstNameAndAge);

        // This is full filter expression represented by the DSL string
        assertThat(query.getCriteriaObject().getFilterExpression()).isEqualTo(Exp.build(
            Exp.and(
                Exp.eq(Exp.bin("firstName", Exp.Type.STRING), Exp.val("Leroi")),
                Exp.ge(Exp.bin("age", Exp.Type.INT), Exp.val(25)),
                Exp.lt(Exp.bin("age", Exp.Type.INT), Exp.val(45))
            )
        ));

        Iterable&lt;Person&gt; result = repository.findUsingQuery(new Query(firstNameAndAge));
        assertThat(result).containsExactlyInAnyOrder(leroi, leroi2);

        // It is currently NOT allowed to combine qualifiers if at least one of them is a DSL expression qualifier
        Qualifier firstNameEq = Qualifier.dslExpressionBuilder()
            // Using a comprehensive static DSL expression with fixed values
            .setDSLExpressionString("$.firstName == 'Leroi'")
            .build();
        Qualifier ageBetween = Qualifier.builder()
            .setPath("age")
            .setFilterOperation(FilterOperation.BETWEEN)
            .setValue(25)
            .setSecondValue(45)
            .build();

        assertThatThrownBy(() -&gt; new Query(Qualifier.and(firstNameEq, ageBetween)))
            .isInstanceOf(UnsupportedOperationException.class)
            .hasMessageContaining("Cannot combine DSL expression qualifiers in a custom logical query");</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="custom-query-indexed-expression">Indexed Using Expression Custom Query Example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">            String indexName = "idx_selected_names_above_25";
            // Build an expression that filters age only for adults with expected names that are 25 or older
            Expression filterExpr = Exp.build(
                Exp.cond(
                    Exp.and(
                        Exp.ge( // Is the age 25 or older?
                            Exp.intBin("age"),
                            Exp.val(25)
                        ),
                        ListExp.getByValue( // Do they have the expected names?
                            ListReturnType.EXISTS,
                            Exp.stringBin("firstName"),
                            Exp.val(List.of("Leroi", "Stefan"))
                        )
                    ),
                    Exp.intBin("age"), // If true, return the age of the customer to be indexed
                    Exp.unknown() // Returns "unknown" to exclude the record from the index
                )
            );

            // Create an index using the Expression
            String setName = template.getSetName(Person.class);
            template.createIndex(setName, indexName, IndexType.NUMERIC, IndexCollectionType.DEFAULT, filterExpr);
            assertThat(template.indexExists(indexName)).isTrue();

            // Create the query
            Qualifier usingIndexWithExpression = Qualifier.indexedWithExpressionBuilder()
                .setIndexName(indexName)
                .setFilterOperation(FilterOperation.GT)
                .setValue(25)
                .build();
            Query query = new Query(usingIndexWithExpression);

            // Run the query
            Iterable&lt;Person&gt; result = repository.findUsingQuery(query);
            assertThat(result).containsExactlyInAnyOrder(stefan, leroi);</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="dsl.expressions">Using DSL Expressions</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="dsl.expressions.intro">Introduction</h3>
<div class="paragraph">
<p>Aerospike DSL (Domain Specific Language) expressions represent a functional language for applying predicates to bin data and record metadata. They provide a powerful and flexible way to query Aerospike data using a dot-separated infix notation. DSL expressions can act as the WHERE clause in your queries, allowing to filter records based on bin values, metadata, navigating through complex nested structures.</p>
</div>
<div class="paragraph">
<p>DSL expressions offer several advantages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Human-readable syntax</strong>: Use recognizable text-based notation (<code>$.binName &gt; 0</code>)</p>
</li>
<li>
<p><strong>Aerospike data structures support</strong>: Support for strings, numbers, booleans, and complex data types</p>
</li>
<li>
<p><strong>Flexible querying</strong>: Work with maps, lists, and nested structures</p>
</li>
<li>
<p><strong>Two usage patterns in Spring Data Aerospike</strong>: Available both as annotations on repository methods and programmatically in custom queries.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The DSL Parser API converts dot-separated string paths into Aerospike filters for applying predicates.</p>
</div>
</div>
<div class="sect2">
<h3 id="dsl.expressions.api">DSL Expressions API</h3>
<div class="sect3">
<h4 id="dsl.expressions.api.syntax">Path Syntax</h4>
<div class="paragraph">
<p>DSL expressions use the following syntax for navigating through basic elements:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Basic Path Elements</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Path Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$.binName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reference to bin "binName"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map key "a"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>'1'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map key (String) "1"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map key 1 (numeric)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{1}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map index 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{=1}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map value (int) 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{=bb}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map value "bb"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{='1'}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map value (String) "1"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{#1}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map rank 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[1]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List index 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[=1]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List value 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[#1]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List rank 1</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Here are some examples for navigating through nested elements:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Examples of Nested Element Navigation</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Nested Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$.mapBinName.a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mapBinName &#8594; mapKey("a")</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$.mapBinName.a.aa.aaa</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mapBinName &#8594; mapKey("a") &#8594; mapKey("aa") &#8594; mapKey("aaa")</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$.mapBinName.a.55</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mapBinName &#8594; mapKey("a") &#8594; mapKey(55)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$.listBinName.[1].aa</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">listBinName &#8594; listIndex(1) &#8594; mapKey("aa")</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$.mapBinName.ab.cd.[-1].'10'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mapBinName &#8594; mapKey("ab") &#8594; mapKey("cd") &#8594; listIndex(-1) &#8594; mapKey("10")</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="dsl.expressions.api.operators">Supported Operators</h4>
<div class="paragraph">
<p>DSL expressions support standard comparison and logical operators:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Comparison</strong>: <code>==</code>, <code>!=</code>, <code>&gt;</code>, <code>&gt;=</code>, <code>&lt;</code>, <code>&lt;=</code></p>
</li>
<li>
<p><strong>Logical</strong>: <code>and</code>, <code>or</code>, <code>not</code>, <code>exclusive</code></p>
</li>
<li>
<p><strong>Grouping</strong>: <code>()</code></p>
</li>
<li>
<p><strong>Type Access</strong>: <code>.get(type: TYPE_NAME)</code> for explicit Aerospike type casting</p>
</li>
<li>
<p><strong>Control Structures</strong>: <code>with</code>, <code>when</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more details, see <a href="https://github.com/aerospike/expression-dsl-java">DSLParser project</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dsl.expressions.repository.methods">Usage with Repository Query Methods</h3>
<div class="paragraph">
<p>You can annotate repository methods in Spring Data Aerospike with <code>@Query</code> to define DSL expression. The expressions will be executed automatically when the annotated repository method is called.</p>
</div>
<div class="sect3">
<h4 id="_static_expressions_in_repository_queries">Static Expressions in Repository Queries</h4>
<div class="paragraph">
<p>Static expressions have fixed values embedded directly in the DSL string:</p>
</div>
<div class="exampleblock">
<div class="title">Example 11. Static DSL expression example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Query(expression = "$.lastName == 'Macintire'")
List&lt;P&gt; findByLastName(String name);</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In static expressions, the method parameters are ignored - the query always uses the fixed value in the expression.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_dynamic_expressions_with_placeholders_in_repository_queries">Dynamic Expressions with Placeholders in Repository Queries</h4>
<div class="paragraph">
<p>Dynamic expressions use placeholders that are replaced with actual method parameter values at runtime:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>?0</code> - First parameter</p>
</li>
<li>
<p><code>?1</code> - Second parameter</p>
</li>
<li>
<p>And so on</p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">Example 12. Examples of repository methods annotated with <code>@Query</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public interface PersonQueryAnnotationRepository&lt;P extends Person&gt;
        extends AerospikeRepository&lt;P, String&gt; {

    // Dynamic expression with placeholder for first parameter
    @Query(expression = "$.firstName == ?0")
    List&lt;P&gt; findByFirstName(String name);

    // Numeric comparison
    @Query(expression = "$.age &gt; ?0")
    List&lt;P&gt; findByAgeGreaterThan(int age);

    // Boolean with explicit type casting
    @Query(expression = "$.isActive.get(type: BOOL) == ?0")
    List&lt;P&gt; findByIsActive(boolean isActive);
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dsl.expressions.custom.queries">Usage with Custom Queries</h3>
<div class="paragraph">
<p>For more complex scenarios or programmatic query construction, you can use DSL expressions with the custom query API through <code>Qualifier.dslExpressionBuilder()</code>.</p>
</div>
<div class="sect3">
<h4 id="dsl.expressions.custom.queries.static">Static DSL Expressions in Custom Queries</h4>
<div class="paragraph">
<p>Create qualifiers with fixed values embedded in the expression:</p>
</div>
<div class="exampleblock">
<div class="title">Example 13. Static DSL expression in custom query</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Setting a static DSL expression with a fixed value
Qualifier positiveActivityQualifier = Qualifier.dslExpressionBuilder()
    .setDslExprString("$.isActive == true")
    .build();

List&lt;Person&gt; activePersons = repository.findUsingQuery(new Query(positiveActivityQualifier));</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dsl.expressions.custom.queries.dynamic">Dynamic DSL Expressions in Custom Queries</h4>
<div class="paragraph">
<p>Create qualifiers with placeholders and provide values separately:</p>
</div>
<div class="exampleblock">
<div class="title">Example 14. Examples of custom queries using DSL expressions</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Setting a dynamic DSL expression with a placeholder and its value
String firstName = "Oliver";
Query firstNameQuery = new Query(
    Qualifier.dslExpressionBuilder()
        .setDslExprString("$.firstName == ?0")
        .setDSLExpressionValues(new Object[]{firstName})
        .build()
);

List&lt;Person&gt; persons = repository.findUsingQuery(firstNameQuery);</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Placeholder values are transferred as an array of Objects (<code>Object[]</code>).</p>
</div>
</div>
<div class="sect3">
<h4 id="dsl.expressions.custom.queries.complex">Complex Expressions</h4>
<div class="paragraph">
<p>You can create comprehensive DSL expressions that combine multiple conditions:</p>
</div>
<div class="exampleblock">
<div class="title">Example 15. Complex DSL expression with multiple conditions</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Using a comprehensive static DSL expression with fixed values
Qualifier colorAndAge = Qualifier.dslExpressionBuilder()
    .setDslExprString("$.favColor == 'green' and $.age &gt;= 28 and $.age &lt; 29")
    .build();

Query query = new Query(colorAndAge);
List&lt;Person&gt; results = repository.findUsingQuery(query);</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dsl.expressions.indexing">Secondary Indexes and DSL Expressions</h3>
<div class="paragraph">
<p>DSL expressions work seamlessly with Aerospike secondary indexes.
When there is one index for a query, it is used to create secondary index Filter.</p>
</div>
<div class="paragraph">
<p>When multiple indexes are available for bins of a complex query, DSLParser automatically does the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Selects one index to build the secondary index <code>Filter</code> (always one per query) based on index cardinality (preferring higher <code>binValuesRatio</code>)</p>
</li>
<li>
<p>Falls back to alphabetical order if cardinality of indexes is equal</p>
</li>
<li>
<p>Uses filtering <code>Expression</code> for remaining parts of the query</p>
</li>
</ol>
</div>
<div class="exampleblock">
<div class="title">Example 16. Using static DSL expression with indexed bins in a custom query</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Qualifier colorAndAge = Qualifier.dslExpressionBuilder()
    .setDslExprString("$.favColor == 'green' and $.age &gt;= 28 and $.age &lt; 29")
    .build();

Query query = new Query(colorAndAge);

// Assuming indexes exist on 'age' and 'favColor' bins
// DSLParser will choose the optimal index for the secondary index filter -
// in this case, for "$.age &gt;= 28" part based on alphabetical order due to the same cardinality,
// and apply the remaining conditions as filtering Expression
Iterable&lt;Person&gt; result = repository.findUsingQuery(query);</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dsl.expressions.limitations">Limitations and Restrictions</h3>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p><strong>Combining custom Qualifiers</strong>: For custom queries, it is currently NOT allowed to combine DSL expression qualifiers with non-DSL qualifiers using <code>Qualifier.and()</code> or <code>Qualifier.or()</code>. This limitation is irrelevant to regular repository queries.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="exampleblock">
<div class="title">Example 17. Invalid qualifier combination</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// DSL expression qualifier
Qualifier colorEqGreen = Qualifier.dslExpressionBuilder()
    .setDslExprString("$.favColor == 'green'")
    .build();

// Regular qualifier
Qualifier ageBetween28And29 = Qualifier.builder()
    .setPath("age")
    .setFilterOperation(FilterOperation.BETWEEN)
    .setValue(28)
    .setSecondValue(29)
    .build();

// This will throw UnsupportedOperationException
Query invalidQuery = new Query(Qualifier.and(colorEqGreen, ageBetween28And29));</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><strong>Solution</strong>: Incorporate all conditions into one comprehensive DSL expression or combine only non-DSL qualifiers:</p>
</div>
<div class="exampleblock">
<div class="title">Example 18. Valid alternatives for custom queries</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Option 1: Combine everything in one DSL expression
Qualifier combined = Qualifier.dslExpressionBuilder()
    .setDslExprString("$.favColor == 'green' and $.age &gt;= 28 and $.age &lt; 29")
    .build();

Query validQuery = new Query(combined);

// Option 2: Use only non-DSL qualifiers with AND/OR
Qualifier color = Qualifier.builder()
    .setPath("favColor")
    .setFilterOperation(FilterOperation.EQ)
    .setValue("green")
    .build();
Qualifier age = Qualifier.builder()
    .setPath("age")
    .setFilterOperation(FilterOperation.BETWEEN)
    .setValue(28)
    .setSecondValue(29)
    .build();

Query validQuery2 = new Query(Qualifier.and(color, age));</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dsl.expressions.best.practices">Best Practices</h3>
<div class="ulist">
<ul>
<li>
<p>Use static expressions for fixed filters that don&#8217;t change</p>
</li>
<li>
<p>Use placeholders when filter values are determined at runtime</p>
</li>
<li>
<p>Consolidate conditions into comprehensive DSL expressions if using custom DSL qualifier</p>
</li>
<li>
<p>Leverage indexes by including indexed bin conditions in your DSL expressions</p>
</li>
<li>
<p>Use explicit type casting (e.g., <code>.get(type: BOOL)</code>) when working with bins that may have ambiguous types</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="aerospike.object-mapping">Aerospike Object Mapping</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Rich mapping support is provided by the <code>AerospikeMappingConverter</code> which has a rich metadata model that provides a full feature set of functionality to map domain objects to Aerospike objects. The mapping metadata model is populated using annotations on your domain objects.
However, the infrastructure is not limited to using annotations as the only source of metadata information.
The <code>AerospikeMappingConverter</code> also allows you to map objects without providing any additional metadata, by following a set of conventions.</p>
</div>
<div class="paragraph">
<p>In this section, we will describe the features of the <code>AerospikeMappingConverter</code>, how to use conventions for mapping objects to documents and how to override those conventions with annotation-based mapping metadata.</p>
</div>
<div class="paragraph">
<p>For more details, refer to Spring Data documentation:
<a href="https://docs.spring.io/spring-data/commons/reference/object-mapping.html">Object Mapping</a>.</p>
</div>
<div class="sect2">
<h3 id="mapping-conventions">Convention Based Mapping</h3>
<div class="paragraph">
<p><code>AerospikeMappingConverter</code> has a few conventions for mapping objects to documents when no additional mapping metadata is provided.
The conventions are:</p>
</div>
<div class="sect3">
<h4 id="mapping-conventions-id-field">How the 'id' Field Is Handled in the Mapping Layer</h4>
<div class="paragraph">
<p>Aerospike DB requires that you have an <code>id</code> field for all objects.
The <code>id</code> field can be of any primitive type as well as <code>String</code> or <code>byte[]</code>.</p>
</div>
<div class="paragraph">
<p>The following table outlines the requirements for the <code>id</code> field:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Examples for the translation of '_id'-field definitions</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field definition</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code> id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A field named 'id' without an annotation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Id</code> <code>String</code> myId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A field annotated with <code>@Id</code> (<code>org.springframework.data.annotation.Id</code>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following description outlines what type of conversion, if any, will be done on the property mapped to the <code>id</code> document field:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>By default, the type of the field annotated with <code>@id</code> is turned into a <code>String</code> to be stored in Aerospike database.
If the original type cannot be persisted (see <a href="#configuration.keep-original-key-types">keepOriginalKeyTypes</a>
for details), it must be convertible to <code>String</code> and will be stored in the database as such, then converted back to the original type when the object is read.
This is transparent to the application but needs to be considered if using external tools like <code>AQL</code> and the Aerospike JDBC Driver to view the data.</p>
</li>
<li>
<p>If no field named "id" is present in the Java class then an implicit '_id' file will be generated by the driver but not mapped to a property or field of the Java class.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When querying and updating <code>AerospikeTemplate</code> will use the converter to handle conversions of the <code>Query</code> and <code>Update</code> objects that correspond to the above rules for saving documents so field names and types used in your queries will be able to match what is in your domain classes.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mapping-configuration">Mapping Configuration</h3>
<div class="paragraph">
<p>Unless explicitly configured, an instance of <code>AerospikeMappingConverter</code> is created by default when creating a <code>AerospikeTemplate</code>.
You can create your own instance of the <code>MappingAerospikeConverter</code> so as to tell it where to scan the classpath at the startup of your domain classes in order to extract metadata and construct indexes.
Also, to have more control over the conversion process (if needed), you can register converters to use for mapping specific classes to and from the database.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
AbstractAerospikeConfiguration will create an AerospikeTemplate instance and register with the container under the name 'AerospikeTemplate'.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="mapping-usage-annotations">Mapping Annotation Overview</h4>
<div class="paragraph">
<p>The MappingAerospikeConverter can use metadata to drive the mapping of objects to documents using annotations.
An overview of the annotations is provided below</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@Id</code> - applied at the field level to mark the field used for identity purposes.</p>
</li>
<li>
<p><code>@Field</code> - applied at the field level, describes the name of the field as it will be represented in the AerospikeDB BSON document thus allowing the name to be different from the field name of the class.</p>
</li>
<li>
<p><code>@Version</code> - applied at the field level to mark record modification count.
The value must be effectively integer.
In Spring Data Aerospike, documents come in two forms  non-versioned and versioned.
Documents with an <code>@Version</code> annotation have a version field populated by the corresponding records generation count.
Version can be passed to a constructor or not (in that case it stays equal to zero).</p>
</li>
<li>
<p><code>@Expiration</code> - applied at the field level to mark a property to be used as expiration field.
Expiration can be specified in two flavors: as an offset in seconds from the current time (then field value must be effectively integer) or as an absolute Unix timestamp.
Client system time must be synchronized with Aerospike server system time, otherwise expiration behaviour will be unpredictable.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The mapping metadata infrastructure is defined in a separate spring-data-commons project that is technology-agnostic.
Specific subclasses are used in the AerospikeDB support to support annotation-based metadata.
Other strategies are also possible to put in place if there is demand.</p>
</div>
<div class="paragraph">
<p>Here is an example of a more complex mapping.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class Person&lt;T extends Address&gt; {

  @Id
  private String id;

  private Integer ssn;

  @Field("fName")
  private String firstName;

  private String lastName;

  private Integer age;

  private Integer accountTotal;

  private List&lt;Account&gt; accounts;

  private T address;

  @Version
  private int id; // must be integer

  public Person(Integer ssn) {
    this.ssn = ssn;
  }

  public Person(Integer ssn, String firstName, String lastName, Integer age, T address, int version) {
    this.ssn = ssn;
    this.firstName = firstName;
    this.lastName = lastName;
    this.age = age;
    this.address = address;
    this.version = version;
  }

  public String getId() {
    return id;
  }

  // no setter for Id.  (getter is only exposed for some unit testing)

  public Integer getSsn() {
    return ssn;
  }

// other getters/setters omitted
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="mapping-parameter-name-known-issue">Troubleshooting "Parameter Does Not Have a Name": Known Issue</h4>
<div class="paragraph">
<p>Let&#8217;s assume we have a complex entity called <code>Person</code>. In order to get a smaller subset of fields (only <code>firstName</code>, <code>lastName</code> and <code>email</code>) from <code>Person</code> object we want to run a simple <code>find</code> query using DTO projection, so we create a DTO entity called <code>PersonSomeFields</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Data
@Builder
public class PersonSomeFields {

    private String firstName;
    private String lastName;
    @Field("email")
    private String emailAddress;
}

List&lt;PersonSomeFields&gt; result = repository.findPersonSomeFieldsByFirstName("Carter");</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, when we run this query, it might lead to a <code>MappingException</code> with the message "Parameter %s does not have a name".</p>
</div>
<div class="paragraph">
<p>When mapping to a DTO / entity class like <code>PersonSomeFields</code> (often annotated with Lombok&#8217;s <code>@Data</code> and <code>@Builder</code>), Spring Data attempts to create an instance of <code>PersonSomeFields</code>. During this process, it tries to identify the constructor parameters and their corresponding property names.</p>
</div>
<div class="paragraph">
<p>Without a no-argument constructor explicitly defined or generated, Spring Data attempts to use the implicitly generated constructor. To correctly map constructor parameters to entity properties, it relies on the parameter names being available at runtime. However, Java compiler or Lombok&#8217;s generated constructors often do not retain parameter names, leading to <code>null</code> being returned for parameter name.</p>
</div>
<div class="paragraph">
<p>The solution is to ensure that Spring Data has a way to instantiate the <code>PersonSomeFields</code> class without relying on extracting parameter names from a constructor that might not have them available at runtime. The simplest and most robust way to achieve this is by providing a no-argument constructor.</p>
</div>
<div class="paragraph">
<p>When using Lombok, this is easily done by adding the <code>@NoArgsConstructor</code> annotation to your DTO class. This instructs Lombok to generate a public no-argument constructor.</p>
</div>
<div class="paragraph">
<p>If you are using <code>@Builder</code> alongside <code>@NoArgsConstructor</code>, it&#8217;s typically required by Lombok to also include <code>@AllArgsConstructor</code>.</p>
</div>
<div class="paragraph">
<p>Here is an example of the modified class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class PersonSomeFields {

    private String firstName;
    private String lastName;
    @Field("email")
    private String emailAddress;
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="aerospike.custom-converters">Aerospike Custom Converters</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring type converters are components used to convert data between different types, particularly when interacting with databases or binding data from external sources. They facilitate seamless transformation of data, such as converting between String and database-specific types (e.g., LocalDate to DATE or String to enumerations).</p>
</div>
<div class="paragraph">
<p>For more details, see <a href="https://docs.spring.io/spring-framework/reference/core/validation/convert.html">Spring Type Conversion</a>.</p>
</div>
<div class="paragraph">
<p>Spring provides a set of default type converters for common conversions. Spring Data Aerospike has its own built-in converters in <code>DateConverters</code> and <code>AerospikeConverters</code> classes.</p>
</div>
<div class="paragraph">
<p>However, in certain cases, custom converters are necessary to handle specific logic or custom serialization requirements. Custom converters allow developers to define precise conversion rules, ensuring data integrity and compatibility between application types and database representations.</p>
</div>
<div class="paragraph">
<p>In order to add a custom converter you can leverage Spring&#8217;s <code>Converter</code> SPI to implement type conversion logic and override <code>customConverters()</code> method available in <code>AerospikeDataConfigurationSupport</code>.</p>
</div>
<div class="paragraph">
<p>Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class BlockingTestConfig extends AbstractAerospikeDataConfiguration {

    @Override
    protected List&lt;Object&gt; customConverters() {
        return List.of(
            CompositeKey.CompositeKeyToStringConverter.INSTANCE,
            CompositeKey.StringToCompositeKeyConverter.INSTANCE
        );
    }

    @Value
    public static class CompositeKey {

        String firstPart;
        long secondPart;

        @WritingConverter
        public enum CompositeKeyToStringConverter implements Converter&lt;CompositeKey, String&gt; {
            INSTANCE;

            @Override
            public String convert(CompositeKey source) {
                return source.firstPart + "::" + source.secondPart;
            }
        }

        @ReadingConverter
        public enum StringToCompositeKeyConverter implements Converter&lt;String, CompositeKey&gt; {
            INSTANCE;

            @Override
            public CompositeKey convert(String source) {
                String[] split = source.split("::");
                return new CompositeKey(split[0], Long.parseLong(split[1]));
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more examples see the <a href="https://github.com/aerospike/spring-data-aerospike-demo/blob/main/asciidoc/custom-converters.adoc">Custom Converters Guide</a> in the demo repository.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="pagination_and_sorting">Pagination and Sorting in Spring Data Aerospike</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Data Aerospike provides support for sorting and pagination of results of repository query methods,
allowing to retrieve and display data from database using familiar Spring Data interfaces like <code>Pageable</code> and <code>Slice</code>,
and objects like <code>Sort</code> and <code>PageRequest</code>.</p>
</div>
<div class="sect2">
<h3 id="pagination_and_sorting.standalone_sorting">Standalone Sorting</h3>
<div class="paragraph">
<p>Spring Data Aerospike supports standalone sorting for repository query methods. This allows to order the results
of a query without applying pagination. It can be achieved by simply providing a Spring Data <code>Sort</code> object
as a parameter to your repository method.</p>
</div>
<div class="listingblock">
<div class="title">Example: Standalone Sorting</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// In your repository interface
List&lt;Person&gt; findByLastNameStartingWith(String lastNamePrefix, Sort sort);

// Usage example: retrieving persons sorted by last name
List&lt;Person&gt; persons = repository.findByLastNameStartingWith("M", Sort.by("lastName").ascending());
// The 'persons' list will contain all matching entities, sorted by their last names in ascending order.</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="pagination_and_sorting.return_types">Paginated Queries: Returning <code>Page</code> and <code>Slice</code></h3>
<div class="paragraph">
<p>Paginated repository queries in Spring Data allow retrieving a subset of data from a larger result set,
along with optional sorting, to manage and display data in manageable chunks.</p>
</div>
<div class="paragraph">
<p>When performing paginated repository queries, Spring Data Aerospike offers two return types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Page</code>: This type extends <code>Slice</code> and includes additional information about the total number of elements
and total pages available. This is useful when you need the full context of your data, such as "Page X of Y"
or the total record count.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example: <code>Page</code> usage</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// In your repository interface
Page&lt;Person&gt; findByAgeLessThan(int age, Pageable pageable);

// Usage example for an unpaged query in a test
Page&lt;Person&gt; page = repository.findByAgeLessThan(40, Pageable.unpaged());
// Assertions related to content, element count, and total pages/elements etc.
assertThat(page.hasContent()).isTrue();
assertThat(page.getNumberOfElements()).isGreaterThan(1);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Slice</code>: This type represents a sub-list of data and provides information about whether there&#8217;s a next
or previous slice available. It can be used for infinite scrolling or continuous loading scenarios where
the total count is not immediately required.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example: <code>Slice</code> usage</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// In your repository interface
Slice&lt;Person&gt; findByAgeGreaterThan(int age, Pageable pageable);

// Example of using PageRequest in a test
Slice&lt;Person&gt; slice = repository.findByAgeGreaterThan(40, PageRequest.of(0, 10));
// Assertions related to content and next/previous slice availability etc.
assertThat(slice.hasContent()).isTrue();
assertThat(slice.hasNext()).isFalse();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="pagination_and_sorting.page_request"><code>PageRequest</code> for Pagination</h3>
<div class="paragraph">
<p>The <code>PageRequest</code> class is used to specify pagination parameters, typically consisting of a <code>pageNumber</code> and <code>pageSize</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>pageNumber</code>: Represents the requested page. Pages are 0-indexed, meaning <code>pageNumber = 0</code> refers to the first page,
<code>pageNumber = 1</code> to the second, and so on.</p>
</li>
<li>
<p><code>pageSize</code>: Defines the maximum number of records to be returned on a single page.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For instance, <code>PageRequest.of(1, 4)</code> would request the second page (offset by 1) containing a maximum of 4 records.</p>
</div>
</div>
<div class="sect2">
<h3 id="pagination_and_sorting.sorting_with_pagination">Sorting with Pagination</h3>
<div class="paragraph">
<p>A key consideration in Spring Data Aerospike is that when query methods receive a <code>PageRequest</code> with an <code>offset</code>
(i.e., <code>pageNumber</code> greater than 0), they <strong>must</strong> also include <code>Sort</code> criteria. This ensures consistent
and predictable pagination results, as Aerospike itself does not guarantee natural order across all queries.</p>
</div>
<div class="paragraph">
<p>The only exception to this rule is for purely ID equality queries, where the inherent order of IDs can be used
for offset and limitation.</p>
</div>
<div class="listingblock">
<div class="title">Example: Paginated query with sorting</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// In your repository interface (example similar to findByAgeGreaterThan)
Slice&lt;Person&gt; findByAgeGreaterThan(int age, Pageable pageable);

// Usage example in a test: a regular query method with offset, sorting must be specified
Slice&lt;Person&gt; last = repository.findByAgeGreaterThan(20, PageRequest.of(4, 2, Sort.by("age")));
// Assertions on content and navigation etc.</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="pagination_and_sorting.id_based_pagination">ID-Based Pagination without Explicit Sorting</h4>
<div class="paragraph">
<p>For queries that are solely based on ID equality, pagination with an offset is permitted even without explicit sorting.
This is because the original order of IDs can be leveraged for applying offset and limit on the application level.</p>
</div>
<div class="listingblock">
<div class="title">Example: ID-based pagination</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// In your repository interface, a method just for IDs equality
Page&lt;P&gt; findAllById(Iterable&lt;String&gt; ids, Pageable pageable);

// Usage example in a test, the only type of queries without mandatory sorting when offset is given
Page&lt;Person&gt; result1 = repository.findAllById(ids, PageRequest.of(1, 2));
// Assertions on total pages and iteration over results etc.</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="pagination_and_sorting.application_level_operations">Application-Level Operations</h3>
<div class="paragraph">
<p>It is important to note that sorting and pagination operations in Spring Data Aerospike are performed
at the application level. Spring Data Aerospike first retrieves all query results and then applies the sorting
and/or pagination as a post-processing step within the application.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="aerospike.template">Aerospike Template</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Aerospike Template provides a set of features for interacting with the database.
It allows lower-level access than a Repository and also serves as the foundation for repositories.</p>
</div>
<div class="paragraph">
<p>Template is the central support class for Aerospike database operations.
It provides the following functionality:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Methods to interact with the database</p>
</li>
<li>
<p>Mapping between Java objects and Aerospike Bins (see <a href="#aerospike.object-mapping">Object Mapping</a>)</p>
</li>
<li>
<p>Providing connection callback</p>
</li>
<li>
<p>Translating exceptions into Spring&#8217;s technology-agnostic
<a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/html/dao.html#dao-exceptions">DAO exceptions hierarchy</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="aerospike-template.instantiating">Instantiating AerospikeTemplate</h3>
<div class="paragraph">
<p>If you are subclassing <code>AbstractAerospikeDataConfiguration</code> then the <code>aerospikeTemplate</code> bean is already present
in your context, and you can use it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Autowired
protected AerospikeTemplate template;</code></pre>
</div>
</div>
<div class="paragraph">
<p>An alternative is to instantiate it yourself, you can see the bean in <code>AbstractAerospikeDataConfiguration</code>.</p>
</div>
<div class="paragraph">
<p>In case if you need to use custom <code>WritePolicy</code>, the <code>persist</code> operation can be used.</p>
</div>
<div class="paragraph">
<p>For CAS updates <code>save</code> operation must be used.</p>
</div>
</div>
<div class="sect2">
<h3 id="_methods_for_interacting_with_database">Methods for interacting with database</h3>
<div class="paragraph">
<p><code>AerospikeOperations</code> interface provides operations for interacting with the database (<code>exists</code>, <code>find</code>, <code>insert</code>,
<code>update</code> etc.) as well as basic operations with indexes: <code>createIndex</code>, <code>deleteIndex</code>, <code>indexExists</code>.</p>
</div>
<div class="paragraph">
<p>The names of operations are typically self-descriptive. To read from Aerospike you can use <code>findById</code>, <code>findByIds</code>
and <code>find</code> methods, to delete - <code>delete</code> methods, and so on.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">template.findById(id, Person.class)</code></pre>
</div>
</div>
<div class="paragraph">
<p>For indexed documents use <code>find</code> with provided <code>Query</code> object.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Stream&lt;Person&gt; result = template.find(query, Person.class);
assertThat(result).hasSize(6);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_example">Example</h3>
<div class="paragraph">
<p>The simple case of using the save operation is to save a POJO.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
For more information about Id property when inserting or saving see
<a href="#mapping-conventions-id-field">Mapping Conventions: Id Field</a> for more information.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class Person {

    @Id
    private String id;
    private String firstName;
    private String lastName;
    private int age;
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">template.insert(new Person(id, "John", 50));

long count = template.count
            (new Query
                (new QualifierBuilder()
                    .setFilterOperation(FilterOperation.EQ)
                    .setPath("firstName")
                    .setValue("John")
                    .build()
                ),
            Person.class
            );

        assertThat(count).isEqualTo(3);</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="secondary-indexes">Secondary Indexes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A secondary index (SI) is a data structure that locates all the records in a namespace, or a set within it, based on
a bin value in the record.
When a value is updated in the indexed record, the secondary index automatically updates.</p>
</div>
<div class="paragraph">
<p>You can read more about secondary index implementation and usage in Aerospike
<a href="https://docs.aerospike.com/server/architecture/secondary-index">on the official documentation page</a>.</p>
</div>
<div class="sect2">
<h3 id="_why_secondary_index">Why Secondary Index</h3>
<div class="paragraph">
<p>Let&#8217;s consider a simple query for finding by equality:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public List&lt;Person&gt; personRepository.findByLastName(lastName);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that findByLastName is not a simple lookup by key, but rather finding all records in a set.
Aerospike has 2 ways of achieving this:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Scanning all the records in the set and extracting the appropriate records.</p>
</li>
<li>
<p>Defining a secondary index on the field <code>lastName</code> and using this secondary index to satisfy the query.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The second approach is far more efficient.
Aerospike stores the secondary indexes in a memory structure, allowing exceptionally fast identification of the
records that match.</p>
</div>
<div class="paragraph">
<p>It relies on a secondary index having been created.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ways_to_create_secondary_indexes">Ways to Create Secondary Indexes</h3>
<div class="paragraph">
<p>In SpringData Aerospike secondary indexes can either be created by systems administrators using the <code>asadm</code> tool,
or by developers telling SpringData that such an index is necessary.</p>
</div>
<div class="paragraph">
<p>There are two ways to accomplish this task with the help of SpringData Aerospike:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Using AerospikeTemplate <code>createIndex</code> method.</p>
</li>
<li>
<p>Using <code>@Indexed</code> annotation on the necessary field of an entity.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_creating_secondary_index_via_aerospiketemplate">Creating Secondary Index via AerospikeTemplate</h3>
<div class="paragraph">
<p>For more information about AerospikeTemplate see the <a href="#aerospike.template">documentation page</a>.</p>
</div>
<div class="paragraph">
<p>Setting a secondary index via AerospikeTemplate can be helpful, for example, in cases when an index creation does not
change a lot.</p>
</div>
<div class="paragraph">
<p>Here is an example of a numeric secondary index for the <code>rating</code> field in the <code>MovieDocument</code> entity:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Slf4j
@Configuration
public class AerospikeIndexConfiguration {

    private static final String INDEX_NAME = "movie-rating-index";

    @Bean
    @ConditionalOnProperty(
            value = "aerospike." + INDEX_NAME + ".create-on-startup",
            havingValue = "true",
            matchIfMissing = true)
    public boolean createAerospikeIndex(AerospikeTemplate aerospikeTemplate) {
        try {
            aerospikeTemplate.createIndex(MovieDocument.class, INDEX_NAME, "rating", IndexType.NUMERIC);
            log.info("Index {} was successfully created", INDEX_NAME);
        } catch (Exception e) {
            log.info("Index {} creation failed: {}", INDEX_NAME, e.getMessage());
        }
        return true;
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_creating_secondary_index_using_indexed_annotation">Creating Secondary Index using @Indexed annotation</h3>
<div class="paragraph">
<p>You can use <code>@Indexed</code> annotation on the field where the index is required.
Here is an example of the <code>Person</code> object getting indexed by <code>lastName</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@AllArgsConstructor
@NoArgsConstructor
@Data
@Document
public class Person {
    @Id
    private long id;
    private String firstName;
    @Indexed(name = "lastName_idx", type = IndexType.STRING)
    private String lastName;
    private Date dateOfBirth;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The annotation allows to specify also bin name, collectionType and ctx (context) if needed.
For the details on using <code>@Indexed</code> annotation see <a href="#indexed-annotation">Indexed Annotation</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_matching_the_secondary_index">Matching the Secondary Index</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In Aerospike, secondary indexes are case-sensitive, they match the exact queries.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Following the query from the example above, assume there was a new requirement to be able to find by <code>lastName</code>
containing a String (rather than having an equality match):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public List&lt;Person&gt; findByLastNameContaining(String lastName);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case <code>findByLastNameContaining</code> query is not satisfied by the created secondary index.
Aerospike would need to scan the data which can be an expensive operation as all records in the set must be read
by the Aerospike server, and then the condition is applied to see if they match.</p>
</div>
<div class="paragraph">
<p>Due to the cost of performing this operation, scans from Spring Data Aerospike are disabled by default.</p>
</div>
<div class="paragraph">
<p>For the details on how to enable scans see <a href="#aerospike.scan-operation">scan operation</a>.</p>
</div>
<div class="paragraph">
<p>Following the query from the example above, assume there was a new requirement to be able to find by <code>firstName</code>
with an exact match:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public List&lt;Person&gt; findByLastName(String lastName);
public List&lt;Person&gt; findByFirstName(String firstName);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case <code>firstName</code> is not marked as <code>@Indexed</code>, so SpringData Aerospike is not instructed to create an index on it.
Hence, it will scan the repository (a costly operation that could be avoided by using an index).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
There are relevant configuration parameters:
<a href="#configuration.create-indexes-on-startup">create indexes on startup</a> and
<a href="#configuration.index-cache-refresh-frequency-seconds">indexes cache refresh frequency</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="indexed-annotation">Indexed Annotation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>@Indexed</code> annotation allows to create secondary index based on a specific field of a Java object.
For the details on secondary indexes in Aerospike see <a href="#secondary-indexes">Secondary Indexes</a>.</p>
</div>
<div class="paragraph">
<p>The annotation allows to specify the following parameters:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 17.0731%;">
<col style="width: 29.2682%;">
<col style="width: 21.9512%;">
<col style="width: 31.7075%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">parameter</th>
<th class="tableblock halign-left valign-top">index type</th>
<th class="tableblock halign-left valign-top">mandatory</th>
<th class="tableblock halign-left valign-top">example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">index name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"friend_address_keys_idx"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">index type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IndexType.STRING</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">indexed bin type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"friend"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">collectionType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">index type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IndexCollectionType.MAPKEYS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ctx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">context (path to the indexed elements)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"address"</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Here is an example of creating a complex secondary index for fields of a person&#8217;s friend address.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Data
@AllArgsConstructor
public class Address {

    private String street;
    private Integer apartment;
    private String zipCode;
    private String city;
}

@Data
@NoArgsConstructor
@Setter
public class Friend {

    String name;
    Address address;
}

@Data
@Document
@AllArgsConstructor
@NoArgsConstructor
@Setter
public class Person {

    @Id
    String id;
    @Indexed(type = IndexType.STRING, name = "friend_address_keys_idx",
    collectionType = IndexCollectionType.MAPKEYS, ctx = "address")
    Friend friend;
}

@Test
void test() {
    Friend carter = new Friend();
    carter.setAddress(new Address("Street", 14, "1234567890", "City"));

    Person dave = new Person();
    dave.setFriend(carter);
    repository.save(dave);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A <code>Person</code> object in this example has a field called "friend" (<code>Friend</code> object).
A <code>Friend</code> object has a field called "address" (<code>Address</code> object).
So when "friend" field is set to a <code>Friend</code> with existing <code>Address</code>, we have a person (<code>dave</code> in the example above)
with a friend (<code>carter</code>) who has
a particular address.</p>
</div>
<div class="paragraph">
<p><code>Address</code> object on its own has certain fields: <code>street</code>, <code>apartment</code>, <code>zipCode</code>, <code>city</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In Aerospike DB a POJO (such as <code>Address</code>) is represented by a Map, so the fields of POJO become map keys.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Thus, if we want to index by <code>Address</code> object fields, we set <code>collectionType</code> to <code>IndexCollectionType.MAPKEYS</code>.</p>
</div>
<div class="paragraph">
<p><code>Ctx</code> parameter represents context, or path to the necessary element in the specified bin ("friend") - which is
"address", because we want to index by fields of friend&#8217;s address.</p>
</div>
<div class="sect2">
<h3 id="_secondary_index_context_dsl">Secondary Index Context DSL</h3>
<div class="paragraph">
<p>Secondary index context (<code>ctx</code> parameter in <code>@Indexed</code> annotation) represents path to a necessary element in hierarchy.
It uses infix notation.</p>
</div>
<div class="paragraph">
<p>The document path is described as dot-separated context elements (e.g., "a.b.[2].c") written as a string.
A path is made of singular path elements and ends with one (a leaf element) or more elements (leaves) - for example,
"a.b.[2].c.[0:3]".</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 42.8571%;">
<col style="width: 32.1429%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Path Element</th>
<th class="tableblock halign-left valign-top">Matches</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"a"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map key a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Single element by key</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"1"</code> or <code>'1'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map key (numeric string) 1</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map key (integer) 1</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{1}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map index 1</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{=1}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map value (integer) 1</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{=bb}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map value bb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Also {="bb"}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{="1"}</code> or <code>{='1'}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map value (string) 1</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{#1}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map rank 1</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[1]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List index 1</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[=1]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List value 1</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[#1]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List rank 1</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_example_2">Example</h4>
<div class="paragraph">
<p>Let&#8217;s consider a Map bin example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">{
  1: a,
  2: b,
  4: d,
  "5": e,
  a: {
    55: ee,
    "66": ff,
    aa: {
      aaa: 111,
      bbb: 222,
      ccc: 333,
    },
    bb: {
      bba: 221,
      bbc: 223
    },
    cc: [ 22, 33, 44, 55, 43, 32, 44 ],
    dd: [ {e: 5, f:6}, {z:26, y:25}, {8: h, "9": j} ]
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>So the following will be true:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 41.6666%;">
<col style="width: 25.0001%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Path</th>
<th class="tableblock halign-left valign-top">CTX</th>
<th class="tableblock halign-left valign-top">Matched Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.aa.aaa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[mapKey("a"), mapKey("aa"), mapKey("aaa")]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">111</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.55</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[mapKey("a"), mapKey(55)]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ee</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">a."66"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[mapKey("a"), mapKey("66")]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ff</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.aa.{2}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[mapKey("a"), mapKey("aa"),mapIndex(2)]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">333</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.aa.{=222}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[mapKey("a"), mapKey("aa"),mapValue(222)]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">222</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.bb.{#-1}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[mapKey("a"), mapKey("bb"),mapRank(-1)]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">223</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.cc.[0]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[mapKey("a"), mapKey("cc"),listIndex(0)]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">22</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.cc.[#1]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[mapKey("a"), mapKey("cc"),listRank(1)]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.cc.[=44]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[mapKey("a"), mapKey("cc"),listValue(44)]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[44, 44]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.dd.[0].e</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[mapKey("a"), mapKey("dd"),listIndex(0), mapKey("e")]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.dd.[2].8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[mapKey("a"), mapKey("dd"),listIndex(2), mapKey(8)]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">h</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.dd.[-1]."9"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[mapKey("a"), mapKey("dd"),listIndex(-1), mapKey("9")]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">j</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.dd.[1].{#0}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[mapKey("a"), mapKey("dd"),listIndex(1), mapRank(0)]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
There are relevant configuration parameters:
<a href="#configuration.create-indexes-on-startup">create indexes on startup</a> and
<a href="#configuration.index-cache-refresh-frequency-seconds">indexes cache refresh frequency</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="aerospike.scan-operation">Scan Operation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A scan can be an expensive operation as all records in the set must be read by the Aerospike server,
and then the condition is applied to see if they match.</p>
</div>
<div class="paragraph">
<p>Due to the cost of performing this operation, scans from Spring Data Aerospike are disabled by default.</p>
</div>
<div class="sect2">
<h3 id="_enabling_scan">Enabling Scan</h3>
<div class="paragraph">
<p>If the cost of the scans is acceptable to an organization, they can be enabled by setting
<a href="#configuration.scans-enabled"><code>scansEnabled</code></a> parameter to <code>true</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">spring.data.aerospike.scans-enabled=true</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Once this flag is enabled, scans run whenever needed with no warnings.
This may or may not be optimal in a particular use case.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="caching">Caching</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Caching is the process of storing data in a cache or temporary storage location, usually to improve application
performance and make data access faster.</p>
</div>
<div class="paragraph">
<p>The caching process also provides an efficient way to reuse previously retrieved or computed data.
The cache is used to reduce the need for accessing the underlying storage layer which is slower.</p>
</div>
<div class="paragraph">
<p>Spring Cache with Aerospike database allows you to use annotations such as <code>@Cacheable</code>, <code>@CachePut</code>
and <code>@CacheEvict</code> that provide a fully managed cache store using Aerospike database.</p>
</div>
<div class="sect2">
<h3 id="_introduction">Introduction</h3>
<div class="paragraph">
<p>In this example, we are going to use the annotations on <code>UserRepository</code> class methods to create/read/update
and delete users data from the cache.</p>
</div>
<div class="paragraph">
<p>If a <code>User</code> is stored in the cache, calling a method with <code>@Cacheable</code> annotation will fetch the user from
the cache instead of executing the methods body responsible for the actual user fetch from the database.</p>
</div>
<div class="paragraph">
<p>If the <code>User</code> does not exist in the cache, the users data will be fetched from the database and put in the cache
for later usage (a cache miss).</p>
</div>
<div class="paragraph">
<p>With Spring Cache and Aerospike database, we can achieve that with only a few lines of code.</p>
</div>
</div>
<div class="sect2">
<h3 id="_motivation">Motivation</h3>
<div class="paragraph">
<p>Lets say that we are using another database as our main data store.
We dont want to fetch the results from it every time we request the data, instead, we want to get the data from
a cache layer.</p>
</div>
<div class="paragraph">
<p>There is a number of benefits of using a cache layer, here are some of them:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Performance: Aerospike can work purely in RAM but reading a record from Aerospike in Hybrid Memory (primary index
in memory, data stored on Flash drives) is extremely fast as well (~1ms).</p>
</li>
<li>
<p>Reduce database load: Moving a significant part of the read load from the main database to Aerospike can help
balance the resources on heavy loads.</p>
</li>
<li>
<p>Scalability: Aerospike scales horizontally by adding more nodes to the cluster, scaling a relational database
might be tricky and expensive, so if you are facing a read heavy load you can easily scale up the cache layer.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_example_3">Example</h3>
<div class="paragraph">
<p>We will not use an actual database as our main data store for this example, instead, we will simulate database access
by printing a simulation message and replace a database read by just returning a specific <code>User</code>.</p>
</div>
<div class="sect3">
<h4 id="_configuration">Configuration</h4>

</div>
<div class="sect3">
<h4 id="_aerospikeconfigurationproperties">AerospikeConfigurationProperties</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Data
@Component
@ConfigurationProperties(prefix = "aerospike")
public class AerospikeConfigurationProperties {
    private String host;
    private int port;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_aerospikeconfiguration">AerospikeConfiguration</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Configuration
@EnableConfigurationProperties(AerospikeConfigurationProperties.class)
@Import(value = {MappingAerospikeConverter.class, AerospikeMappingContext.class,
        AerospikeTypeAliasAccessor.class,
        AerospikeCustomConversions.class, SimpleTypeHolder.class})
public class AerospikeConfiguration {

    @Autowired
    private MappingAerospikeConverter mappingAerospikeConverter;
    @Autowired
    private AerospikeConfigurationProperties aerospikeConfigurationProperties;

    @Bean(destroyMethod = "close")
    public AerospikeClient aerospikeClient() {
        ClientPolicy clientPolicy = new ClientPolicy();
        clientPolicy.failIfNotConnected = true;
        return new AerospikeClient(clientPolicy, aerospikeConfigurationProperties.getHost(),
            aerospikeConfigurationProperties.getPort());
    }

    @Bean
    public CacheManager cacheManager(IAerospikeClient aerospikeClient,
                                            MappingAerospikeConverter aerospikeConverter,
                                     AerospikeCacheKeyProcessor cacheKeyProcessor) {
        AerospikeCacheConfiguration defaultConfiguration = new AerospikeCacheConfiguration("test");
        return new AerospikeCacheManager(aerospikeClient, mappingAerospikeConverter, defaultConfiguration,
            cacheKeyProcessor);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the AerospikeConfiguration we will create two types of Beans:</p>
</div>
</div>
<div class="sect3">
<h4 id="_aerospikeclient">AerospikeClient</h4>
<div class="paragraph">
<p>Responsible for accessing an Aerospike database and performing database operations.</p>
</div>
</div>
<div class="sect3">
<h4 id="cache-example-configuration-AerospikeCacheManager">AerospikeCacheManager</h4>
<div class="paragraph">
<p>The heart of the cache layer, to define an AerospikeCacheManager you need:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>aerospikeClient (AerospikeClient).</p>
</li>
<li>
<p>aerospikeConverter (MappingAerospikeConverter).</p>
</li>
<li>
<p>defaultCacheConfiguration (AerospikeCacheConfiguration), a default cache configuration that applies when creating
new caches.
Cache configuration contains a namespace, a set (null by default meaning write directly to the namespace w/o
specifying a set) and an expirationInSeconds (AKA TTL, default is 0 meaning use Aerospike servers default).</p>
</li>
<li>
<p>Optional: initialPerCacheConfiguration (Map&lt;String, AerospikeCacheConfiguration&gt;), You can also specify a map
of cache names and matching configuration, it will create the caches with the given matching configuration
at the application startup.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
A cache name is only a link to the cache configuration.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_objects">Objects</h4>
<div class="sect4">
<h5 id="_user">User</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Data
@Document
@AllArgsConstructor
public class User {
    @Id
    private int id;
    private String name;
    private String email;
    private int age;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_repositories">Repositories</h4>
<div class="sect4">
<h5 id="_userrepository">UserRepository</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Repository
public class UserRepository {

    @Cacheable(value = "test", key = "#id")
    public Optional&lt;User&gt; getUserById(int id) {
        System.out.println("Simulating a read from the main data store.");
        // In case the id doesn't exist in the cache
        // it will "fetch" jimmy page with the requested id and add it to the cache (cache miss)
        return Optional.of(new User(id, "jimmy page", "jimmy@gmail.com", 77));
    }

    @CachePut(value = "test", key = "#user.id")
    public User addUser(User user) {
        System.out.println("Simulating addition of " + user + " to the main data store.");
        return user;
    }

    @CacheEvict(value = "test", key = "#id")
    public void removeUserById(int id) {
        System.out.println("Simulating removal of " + id + " from the main data store.");
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The cache annotations require a value field, which is the cache name, if the cache name doesn&#8217;t exist 
by passing initialPerCacheConfiguration param when creating a Bean of AerospikeCacheManager in a configuration class,
it will configure the cache with the properties of the given defaultCacheConfiguration
(Configuration &gt; <a href="#cache-example-configuration-AerospikeCacheManager">AerospikeCacheManager</a>).</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_services">Services</h4>
<div class="sect4">
<h5 id="_userservice">UserService</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Service
@AllArgsConstructor
public class UserService {

    UserRepository userRepository;

    public Optional&lt;User&gt; readUserById(int id) {
        return userRepository.getUserById(id);
    }

    public User addUser(User user) {
        return userRepository.addUser(user);
    }

    public void removeUserById(int id) {
        userRepository.removeUserById(id);
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_controllers">Controllers</h4>
<div class="sect4">
<h5 id="_usercontroller">UserController</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@RestController
@AllArgsConstructor
public class UserController {

    UserService userService;

    @GetMapping("/users/{id}")
    public Optional&lt;User&gt; readUserById(@PathVariable("id") Integer id) {
        return userService.readUserById(id);
    }

    @PostMapping("/users")
    public User addUser(@RequestBody User user) {
        return userService.addUser(user);
    }

    @DeleteMapping("/users/{id}")
    public void deleteUserById(@PathVariable("id") Integer id) {
        userService.removeUserById(id);
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_add_enablecaching">Add @EnableCaching</h4>
<div class="sect4">
<h5 id="_simplespringbootaerospikecacheapplication">SimpleSpringBootAerospikeCacheApplication</h5>
<div class="paragraph">
<p>Add <code>@EnableCaching</code> to the class that contains the main method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@EnableCaching
@SpringBootApplication
public class SimpleSpringBootAerospikeCacheApplication {
    public static void main(String[] args) {
        SpringApplication.run(SimpleSpringBootAerospikeCacheApplication.class, args);
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_test">Test</h3>
<div class="paragraph">
<p>We will use Postman to simulate client requests.</p>
</div>
<div class="sect3">
<h4 id="_add_user_cacheput">Add User (@CachePut)</h4>
<div class="olist loweralpha">
<ol class="loweralpha">
<li>
<p>Create a new POST request with the following url: <a href="http://localhost:8080/users" class="bare">http://localhost:8080/users</a></p>
</li>
<li>
<p>Add a new key-value header in the Headers section:</p>
<div class="literalblock">
<div class="content">
<pre>Key: Content-Type</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Value: application/json</pre>
</div>
</div>
</li>
<li>
<p>Add a Body in a valid JSON format:</p>
<div class="literalblock">
<div class="content">
<pre>{
   "id":1,
   "name":"guthrie",
   "email":"guthriegovan@gmail.com",
   "age":35
}</pre>
</div>
</div>
</li>
<li>
<p>Press Send.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">aql&gt; select * from test
+-----+-----------+----------+-------------+-------------------------------------+
| @user_key  | name | @_class | email         | age                             |
+-----+-----------+----------+-------------+-------------------------------------+
| "1" | "guthrie" | "com.aerospike.cache.simpleSpringBootAerospikeCache.objects.User"  | "guthriegovan@gmail.com" | 35 |
+-----+-----------+----------+-------------+-------------------------------------+</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can now see that this user was added to the cache.</p>
</div>
</div>
<div class="sect3">
<h4 id="_read_user_cacheable">Read User (@Cacheable)</h4>
<div class="olist loweralpha">
<ol class="loweralpha">
<li>
<p>Create a new GET request with the following url: <a href="http://localhost:8080/users/1" class="bare">http://localhost:8080/users/1</a></p>
</li>
<li>
<p>Add a new key-value header in the Headers section:</p>
<div class="literalblock">
<div class="content">
<pre>Key: Content-Type</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Value: application/json</pre>
</div>
</div>
</li>
<li>
<p>Press Send.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_remove_user_cacheevict">Remove User (@CacheEvict)</h4>
<div class="olist loweralpha">
<ol class="loweralpha">
<li>
<p>Create a new DELETE request with the following url: <a href="http://localhost:8080/users/1" class="bare">http://localhost:8080/users/1</a></p>
</li>
<li>
<p>Add a new key-value header in the Headers section:</p>
<div class="literalblock">
<div class="content">
<pre>Key: Content-Type</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Value: application/json</pre>
</div>
</div>
</li>
<li>
<p>Press Send.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>We can now see that this user was deleted from the cache (thanks to the @CacheEvict annotation in the UserRepository).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">aql&gt; select * from test
+-----+-----------+----------+-------------+-------------------------------------+
0 rows in set
+-----+-----------+----------+-------------+-------------------------------------+</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_cache_miss_cacheable">Cache miss (@Cacheable)</h4>
<div class="paragraph">
<p>For reading <code>User</code> that is not in the cache we can use the GET request configured before with an id that we know
for sure is not there.</p>
</div>
<div class="paragraph">
<p>If we try calling the GET request with the id 5, we get the following user data:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
    "id": 5,
    "name": "jimmy page",
    "email": "jimmy@gmail.com",
    "age": 77
}</pre>
</div>
</div>
<div class="paragraph">
<p>We wrote it hard-coded in <code>UserRepository</code> to simulate an actual database fetch of a user id that doesn&#8217;t exist
in the cache.</p>
</div>
<div class="paragraph">
<p>We can now also see that the user was added to the cache.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">aql&gt; select * from test
+-----+-----------+----------+-------------+-------------------------------------+
| @user_key  | name | @_class | email         | age                             |
+-----+-----------+----------+-------------+-------------------------------------+
| "1" | "jimmy page" | "com.aerospike.cache.simpleSpringBootAerospikeCache.objects.User"  | "jimmy@gmail.com" | 77 |
+-----+-----------+----------+-------------+-------------------------------------+</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="transactions">Transactions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the context of database operations, a transaction is a sequence of statements that are executed as a single unit of
work. Transactions typically follow the A.C.I.D. principle:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Atomicity</strong> ensures that a transaction is treated as a single, indivisible unit; either all operations within the
transaction are completed successfully, or none of them are applied.</p>
</li>
<li>
<p><strong>Consistency</strong> ensures that a transaction brings the database from one valid state to another, maintaining all
predefined rules and constraints.</p>
</li>
<li>
<p><strong>Isolation</strong> ensures that transactions operate independently of one another, so that intermediate states of a
transaction are not visible to others.</p>
</li>
<li>
<p><strong>Durability</strong> guarantees that once a transaction has been committed, its changes are permanent.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For more details, see
<a href="https://docs.spring.io/spring-framework/reference/data-access/transaction.html">Spring Transaction Management</a>.</p>
</div>
<div class="sect2">
<h3 id="_choosing_transaction_management_model">Choosing Transaction Management Model</h3>
<div class="paragraph">
<p>Spring offers two models of transaction management: <strong>declarative</strong> and <strong>programmatic</strong>. When choosing between them,
consider the complexity and requirements of your application.</p>
</div>
<div class="paragraph">
<p><strong>Declarative transaction management</strong> is typically preferred for its simplicity and ease of maintenance, as it allows
to define transaction boundaries using annotations without altering the business logic code.
This model suits for most applications where transaction boundaries are straightforward and the business logic
does not require intricate transaction control.</p>
</div>
<div class="paragraph">
<p><strong>Programmatic transaction management</strong> is chosen when you need more fine-grained control over transactions,
such as handling complex transaction scenarios.
This approach is useful in situations where specific transaction behavior needs to be dynamically adjusted
or when integrating with legacy code that requires explicit transaction management. When using this approach,
it is possible to explicitly start, commit, and rollback transactions within the code if needed.</p>
</div>
<div class="paragraph">
<p>In general, declarative management is more straightforward and reduces boilerplate code,
while programmatic management offers more control but at the cost of increased complexity.</p>
</div>
</div>
<div class="sect2">
<h3 id="_declarative_transaction_management">Declarative Transaction Management</h3>
<div class="paragraph">
<p>Declarative transaction management uses annotations to define transaction boundaries and behavior without changing
the business logic code. Its usually more common in Spring applications due to its simplicity and ease of use.</p>
</div>
<div class="paragraph">
<p>You can annotate methods and/or classes with <code>@Transactional</code> to automatically handle transactions, including
committing or rolling back based on execution.</p>
</div>
<div class="paragraph">
<p>Couple other things needed to start working with transactions using declarative approach:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A transaction manager must be specified in your Spring Configuration.</p>
</li>
<li>
<p>Spring Configuration must be annotated with the <code>@EnableTransactionManagement</code> annotation.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_example_4">Example</h4>
<div class="paragraph">
<p>Here is an example that shows applying <code>@Transactional</code> to a method.
It ensures that the entire method runs within a transaction context, and Spring manages the transaction lifecycle
(automatically committing the transaction if the method succeeds or rolling back if it encounters an exception).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Configuration
@EnableTransactionManagement
public class Config {

    @Bean
    public AerospikeTransactionManager aerospikeTransactionManager(IAerospikeClient client) {
        return new AerospikeTransactionManager(client);
    }

    // Other configuration
}

@Service
public class MyService {

    @Transactional
    public void performDatabaseOperations() {
        // Perform database operations
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_programmatic_transaction_management">Programmatic Transaction Management</h3>
<div class="paragraph">
<p>Programmatic transaction management gives developers fine-grained control over transactions through code.
This approach involves manually managing transactions using Springs API.</p>
</div>
<div class="paragraph">
<p>The Spring Framework offers two ways for programmatic transaction management:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Using <code>TransactionTemplate</code> or <code>TransactionalOperator</code> which use callback approach
(for programmatic transaction management in imperative code it is typically recommended to use <code>TransactionTemplate</code>;
for reactive code, <code>TransactionalOperator</code> is preferred).</p>
</li>
<li>
<p>Directly using a <code>TransactionManager</code> implementation.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_example_5">Example</h4>
<div class="paragraph">
<p>Here is an example that shows using a programmatic transaction in a method.
You would use <code>TransactionTemplate</code> to wrap your database operations in a transaction block,
ensuring the transaction is automatically committed if successful or rolled back if an exception occurs.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Configuration
public class Config {

    @Bean
    public AerospikeTransactionManager aerospikeTransactionManager(IAerospikeClient client) {
        return new AerospikeTransactionManager(client);
    }

    @Bean
    public TransactionTemplate transactionTemplate(AerospikeTransactionManager transactionManager) {
        return new TransactionTemplate(transactionManager);
    }

    // Other configuration
}

@Service
public class MyService {

    @Autowired
    TransactionTemplate transactionTemplate;

    public void performDatabaseOperations() {
        transactionTemplate.executeWithoutResult(status -&gt; {
            // Perform database operations
        });
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_aerospike_operations_support">Aerospike Operations Support</h3>
<div class="paragraph">
<p>Behind the curtains Aerospike transaction manager uses an Aerospike feature allowing to group together multiple
Aerospike operation requests into a single transaction.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Not all the Aerospike operations can participate in transactions.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here is a list of Aerospike operations that participate in transactions:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>all single record operations (<code>insert</code>, <code>save</code>, <code>update</code>, <code>add</code>, <code>append</code>, <code>persist</code>, <code>findById</code>, <code>exists</code>, <code>delete</code>)</p>
</li>
<li>
<p>all batch operations without query (<code>insertAll</code>, <code>saveAll</code>, <code>findByIds</code>, <code>deleteAll</code>)</p>
</li>
<li>
<p>queries that include <code>id</code> (e.g., repository queries like <code>findByIdAndName</code>)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following operations do not participate in transactions
(will not become part of a transaction if included into it):</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>truncate</code></p>
</li>
<li>
<p>queries that do not include <code>id</code> (e.g., repository queries like <code>findByName</code>)</p>
</li>
<li>
<p>operations that perform info commands (e.g., <code>indexExists</code>)</p>
</li>
<li>
<p>operations that perform scans (using ScanPolicy)</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="appendix">Appendix</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://docs.spring.io/spring-data/commons/reference/index.html">Spring Data Commons Documentation Reference</a></p>
</div>
<div class="paragraph">
<p><a href="https://docs.spring.io/spring-framework/reference/">Spring Framework Documentation Overview</a></p>
</div>
</div>
</div>
</div>
</body>
</html>